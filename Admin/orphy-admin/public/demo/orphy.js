var Orphy=function(e){"use strict";const t=function(){let e={active:!1,feedbacks:[],currentElement:null,commentBoxVisible:!1};const t=new Set;return{getState:()=>e,setState(n){e={...e,...n},t.forEach(t=>t(e))},subscribe:e=>(t.add(e),()=>t.delete(e)),addFeedback(n){e={...e,feedbacks:[...e.feedbacks,n]},t.forEach(t=>t(e))},getFeedbacks:()=>[...e.feedbacks],reset(){e={active:!1,feedbacks:[],currentElement:null,commentBoxVisible:!1},t.forEach(t=>t(e))}}}(),n={commentBox:{headerNew:"Que souhaitez-vous signaler ?",headerExisting:"Feedbacks sur cet élément",placeholder:"Décrivez votre feedback...",cancel:"Annuler",submit:"Ajouter",submitExisting:"Enregistrer",addAnother:"Ajouter un autre feedback",hint:"⌘Enter pour valider, Esc pour annuler"},types:{bug:"Bug",design:"Design",content:"Contenu",question:"Question"},reviewPanel:{title:"Vos feedbacks",subtitle:"Relisez et envoyez vos annotations",empty:"Aucun feedback pour le moment",emptyHint:"Cliquez sur des éléments pour les annoter",submit:"Envoyer",submitCount:"Envoyer ({{count}})",cancel:"Annuler",sending:"Envoi..."},toast:{successSingle:"Feedback envoyé !",successMultiple:"{{count}} feedbacks envoyés !",error:"Erreur lors de l'envoi",retry:"Réessayer"},toolbar:{feedback:"Feedback",done:"Terminé",review:"Envoyer",messages:"Messages"},replay:{status:{open:"Ouvert",resolved:"Résolu"},close:"Fermer",resolve:"Marquer résolu",resolving:"En cours...",resolved:"Résolu !",hint:"Appuyez sur Esc pour fermer",notePlaceholder:"Décrivez ce qui a été fait...",noteHint:"Note incluse dans le récap client",viewport:"{{width}}×{{height}} • {{device}}",device:{desktop:"Desktop",mobile:"Mobile",tablet:"Tablette"},timeAgo:{now:"À l'instant",minutes:"Il y a {{count}} min",hours:"Il y a {{count}}h",days:"Il y a {{count}}j",weeks:"Il y a {{count}} sem"},fallback:{notFound:"Élément introuvable sur cette page",loadError:"Impossible de charger le feedback",close:"Fermer"}},thread:{author:{client:"Client",agency:"Agence"},anonymous:"Anonyme",replyPlaceholder:"Écrivez une réponse...",send:"Envoyer",sending:"Envoi...",noReplies:"Pas encore de réponses",status:{open:"En attente",treated:"Traité",validated:"Validé"},validateInfo:"L'agence a traité ce retour. Confirmez si c'est résolu :",validate:"Valider",validating:"Validation...",validated:"Validé !"},minimizedBar:{expand:"Agrandir",previous:"Précédent",next:"Suivant",minimize:"Réduire"}},o={fr:n,en:{commentBox:{headerNew:"What would you like to report?",headerExisting:"Feedback on this element",placeholder:"Describe your feedback...",cancel:"Cancel",submit:"Add",submitExisting:"Save",addAnother:"Add another feedback",hint:"⌘Enter to submit, Esc to cancel"},types:{bug:"Bug",design:"Design",content:"Content",question:"Question"},reviewPanel:{title:"Your feedback",subtitle:"Review and submit your annotations",empty:"No feedback yet",emptyHint:"Click on elements to annotate them",submit:"Submit",submitCount:"Submit ({{count}})",cancel:"Cancel",sending:"Sending..."},toast:{successSingle:"Feedback sent!",successMultiple:"{{count}} feedbacks sent!",error:"Failed to send",retry:"Retry"},toolbar:{feedback:"Feedback",done:"Done",review:"Review",messages:"Messages"},replay:{status:{open:"Open",resolved:"Resolved"},close:"Close",resolve:"Mark resolved",resolving:"Resolving...",resolved:"Resolved!",hint:"Press Esc to close",notePlaceholder:"Describe what was done...",noteHint:"Note included in client summary",viewport:"{{width}}×{{height}} • {{device}}",device:{desktop:"Desktop",mobile:"Mobile",tablet:"Tablet"},timeAgo:{now:"Just now",minutes:"{{count}}m ago",hours:"{{count}}h ago",days:"{{count}}d ago",weeks:"{{count}}w ago"},fallback:{notFound:"Element not found on this page",loadError:"Failed to load feedback",close:"Close"}},thread:{author:{client:"Client",agency:"Agency"},anonymous:"Anonymous",replyPlaceholder:"Write a reply...",send:"Send",sending:"Sending...",noReplies:"No replies yet",status:{open:"Pending",treated:"Treated",validated:"Validated"},validateInfo:"The agency has addressed this feedback. Confirm if it's resolved:",validate:"Validate",validating:"Validating...",validated:"Validated!"},minimizedBar:{expand:"Expand",previous:"Previous",next:"Next",minimize:"Minimize"}}};let r=n;function i(e,t){const n=e.split(".");let o=r;for(const r of n){if(!o||"object"!=typeof o||!(r in o))return console.warn(`Orphy: Missing translation for "${e}"`),e;o=o[r]}return"string"!=typeof o?(console.warn(`Orphy: Translation "${e}" is not a string`),e):t?o.replace(/\{\{(\w+)\}\}/g,(e,n)=>t[n]?.toString()??`{{${n}}}`):o}function s(){return`session_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}const l=function(){let e={sessionId:s(),drafts:[],submitted:!1};const t=new Set;return{getSession:()=>e,getDrafts:()=>[...e.drafts],getDraft:t=>e.drafts.find(e=>e.tempId===t)??null,getDraftCount:()=>e.drafts.filter(e=>"draft"===e.status).length,getDraftsByElement:t=>e.drafts.filter(e=>e.orphyId===t),addDraft(t){const o={...t,tempId:`draft_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:"draft",timestamp:Date.now()};return e={...e,drafts:[...e.drafts,o]},n(),o},updateDraft(t,o){const r=e.drafts.findIndex(e=>e.tempId===t);if(-1===r)return!1;const i=[...e.drafts],s=i[r];if(!s)return!1;const l={tempId:s.tempId,orphyId:s.orphyId,selector:s.selector,boundingBox:s.boundingBox,positionInElement:s.positionInElement,positionInViewport:s.positionInViewport,viewport:s.viewport,pageUrl:s.pageUrl,feedbackType:void 0!==o.feedbackType?o.feedbackType:s.feedbackType,comment:void 0!==o.comment?o.comment:s.comment,status:void 0!==o.status?o.status:s.status,timestamp:s.timestamp,element:s.element};return i[r]=l,e={...e,drafts:i},n(),!0},removeDraft(t){const o=e.drafts.filter(e=>e.tempId!==t);return o.length!==e.drafts.length&&(e={...e,drafts:o},n(),!0)},markAsSubmitted(){e={...e,submitted:!0},n()},clearSession(){e={sessionId:s(),drafts:[],submitted:!1},n()},subscribe:e=>(t.add(e),()=>t.delete(e))};function n(){t.forEach(t=>t(e))}}();function a(e){const t=e.match(/Edg(?:e|A|iOS)?\/(\d+(?:\.\d+)?)/);if(t)return{name:"Edge",version:t[1]||"unknown"};const n=e.match(/(?:Opera|OPR)\/(\d+(?:\.\d+)?)/);if(n)return{name:"Opera",version:n[1]||"unknown"};const o=e.match(/SamsungBrowser\/(\d+(?:\.\d+)?)/);if(o)return{name:"Samsung Browser",version:o[1]||"unknown"};const r=e.match(/Chrome\/(\d+(?:\.\d+)?)/);if(r&&!e.includes("Chromium"))return{name:"Chrome",version:r[1]||"unknown"};const i=e.match(/Chromium\/(\d+(?:\.\d+)?)/);if(i)return{name:"Chromium",version:i[1]||"unknown"};const s=e.match(/Firefox\/(\d+(?:\.\d+)?)/);if(s)return{name:"Firefox",version:s[1]||"unknown"};const l=e.match(/Version\/(\d+(?:\.\d+)?).*Safari/);if(l)return{name:"Safari",version:l[1]||"unknown"};if(e.includes("Safari")&&!e.includes("Chrome"))return{name:"Safari",version:"unknown"};if(e.includes("Trident/")){const t=e.match(/rv:(\d+(?:\.\d+)?)/);return{name:"Internet Explorer",version:t?.[1]||"11"}}const a=e.match(/MSIE (\d+(?:\.\d+)?)/);return a?{name:"Internet Explorer",version:a[1]||"unknown"}:{name:"Unknown",version:"unknown"}}function d(e){const t=e.match(/(?:iPhone|iPad|iPod).*?OS (\d+[_\.]\d+)/);if(t)return{name:"iOS",version:t[1]?.replace("_",".")||"unknown"};const n=e.match(/Mac OS X (\d+[_\.]\d+(?:[_\.]\d+)?)/);if(n)return{name:"macOS",version:n[1]?.replace(/_/g,".")||"unknown"};const o=e.match(/Android (\d+(?:\.\d+)?)/);if(o)return{name:"Android",version:o[1]||"unknown"};const r=e.match(/Windows NT (\d+\.\d+)/);if(r){const e=r[1];return{name:"Windows",version:{"10.0":"10/11",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.1:"XP"}[e||""]||e||"unknown"}}return e.includes("Linux")?e.includes("CrOS")?{name:"Chrome OS",version:"unknown"}:{name:"Linux",version:"unknown"}:{name:"Unknown",version:"unknown"}}function c(e){return e.includes("iPad")||e.includes("Android")&&!e.includes("Mobile")||e.includes("Tablet")?"tablet":e.includes("Mobile")||e.includes("iPhone")||e.includes("iPod")||e.includes("Android")||/webOS|BlackBerry|IEMobile|Opera Mini/i.test(e)?"mobile":"desktop"}function u(e,t={}){const n=document.createElement(e);if(t.className&&(n.className=t.className),t.styles&&Object.assign(n.style,t.styles),t.attributes)for(const[o,r]of Object.entries(t.attributes))n.setAttribute(o,r);if(t.children)for(const o of t.children)"string"==typeof o?n.appendChild(document.createTextNode(o)):n.appendChild(o);return t.onClick&&n.addEventListener("click",t.onClick),n}const p={primary:"#ffffff",secondary:"#f9f9f8",tertiary:"#f1f1ef"},h={primary:"#37352f",secondary:"#6b6b6b",tertiary:"#9b9b9b",inverse:"#ffffff"},m={default:"#e9e9e7",hover:"#d3d3d0"},y={primary:"#D4A373",hover:"#C4956A",soft:"#FDF6F0"},f={sending:"#c9a227",sendingBg:"#fef9e8",success:"#2e8b57",successBg:"#e8f5ed",error:"#c9444a",errorBg:"#fce8e8"},b={backdrop:"rgba(15, 15, 15, 0.6)",highlight:"rgba(212, 163, 115, 0.20)",highlightBorder:"rgba(212, 163, 115, 0.85)"},g={sans:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif'},w={xs:"11px",sm:"12px",base:"14px",lg:"16px"},v={medium:"500",semibold:"600"},x={base:"1.5",relaxed:"1.6"},C="4px",k="8px",A="12px",S="16px",E="20px",$="24px",I="32px",N={sm:"3px",md:"4px",lg:"6px",xl:"8px",full:"9999px"},M={thin:"1px"},B="0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04)",z="0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.06)",L="0 0 0 2px rgba(212, 163, 115, 0.35)",T={fast:"100ms",base:"150ms",slow:"200ms"},j={default:"cubic-bezier(0.4, 0, 0.2, 1)",out:"cubic-bezier(0, 0, 0.2, 1)"},R="999997",O="999998",F="999999",D="1000000",H={bottom:"20px",right:"20px"},P={padding:{md:"8px 12px"}},W={width:"420px"},V={width:"320px"},U={size:"20px",fontSize:"11px"},q="orphy-responsive-styles",Y=480,X=768;let _=null,J=null,Z=null;const K="\n  0 0 0 2px rgba(255, 255, 255, 0.9),\n  0 0 0 4px rgba(0, 0, 0, 0.25),\n  0 0 16px rgba(212, 163, 115, 0.35)\n".replace(/\s+/g," ").trim(),Q=`\n  0 0 0 2px rgba(255, 255, 255, 0.95),\n  0 0 0 4px ${b.highlightBorder},\n  0 0 0 9999px rgba(15, 15, 15, 0.6)\n`.replace(/\s+/g," ").trim();function G(e){_||ne(),function(){if(!_)return;_.style.backgroundColor=b.highlight,_.style.boxShadow=K}(),J=e,oe()}function ee(e){_||ne(),function(){if(!_)return;_.style.backgroundColor="transparent",_.style.boxShadow=Q}(),J=e,oe()}function te(){_&&(_.style.display="none"),J=null,null!==Z&&(cancelAnimationFrame(Z),Z=null)}function ne(){_=u("div",{className:"orphy-highlight",styles:{position:"fixed",pointerEvents:"none",zIndex:O,border:`2px solid ${b.highlightBorder}`,backgroundColor:b.highlight,borderRadius:N.sm,transition:`all ${T.fast} ${j.out}`,display:"none",boxShadow:"\n        0 0 0 2px rgba(255, 255, 255, 0.9),\n        0 0 0 4px rgba(0, 0, 0, 0.25),\n        0 0 16px rgba(212, 163, 115, 0.35)\n      ".replace(/\s+/g," ").trim()}}),document.body.appendChild(_),window.addEventListener("scroll",re,{passive:!0}),window.addEventListener("resize",re,{passive:!0})}function oe(){if(!_||!J)return;const e=J.getBoundingClientRect();_.style.top=`${e.top}px`,_.style.left=`${e.left}px`,_.style.width=`${e.width}px`,_.style.height=`${e.height}px`,_.style.display="block"}function re(){null===Z&&(Z=requestAnimationFrame(()=>{Z=null,J&&oe()}))}let ie=!1,se=null,le=null;let ae=null,de=null;function ce(){ie=!1}function ue(e,t){if(!se)return null;const n=se.style.display;se.style.display="none";const o=document.elementFromPoint(e,t);return se.style.display=n,o?.closest(".orphy-overlay, .orphy-highlight, .orphy-toolbar, .orphy-comment-box")?null:o}function pe(e){if(ie)return;const n=ue(e.clientX,e.clientY);if(ae&&(clearTimeout(ae),ae=null),!n)return de=null,void te();n!==de&&(ae=setTimeout(()=>{de=n,t.setState({currentElement:n}),G(n),ae=null},80))}function he(e){e.preventDefault(),e.stopPropagation();const t=ue(e.clientX,e.clientY);t&&le&&le(t,e.clientX,e.clientY)}function me(){ie||(ae&&(clearTimeout(ae),ae=null),de=null,te())}function ye(e){if(e.id)return`#${CSS.escape(e.id)}`;const t=e.getAttribute("data-testid");return t?`[data-testid="${CSS.escape(t)}"]`:function(e){const t=[];let n=e;for(;n&&n!==document.body&&n!==document.documentElement;){const e=fe(n);t.unshift(e),n=n.parentElement}return t.join(" > ")}(e)}function fe(e){const t=e.tagName.toLowerCase();if(e.className&&"string"==typeof e.className){const n=e.className.trim().split(/\s+/).filter(Boolean);for(const o of n){if(ge(o))continue;const n=`${t}.${CSS.escape(o)}`;if(be(e,n))return n}}const n=e.parentElement;if(!n)return t;const o=Array.from(n.children).filter(t=>t.tagName===e.tagName);if(1===o.length)return t;return`${t}:nth-of-type(${o.indexOf(e)+1})`}function be(e,t){const n=e.parentElement;if(!n)return!0;return 1===n.querySelectorAll(`:scope > ${t}`).length}function ge(e){return[/^(m|p|w|h|flex|grid|text|bg|border|rounded|shadow|opacity|z-)/,/^(sm:|md:|lg:|xl:|2xl:)/,/^(hover:|focus:|active:|disabled:)/,/^(col-|row-|gap-|space-)/,/^d-(none|block|flex|grid|inline)/].some(t=>t.test(e))}function we(e,t,n){const o=e.getBoundingClientRect(),r=`rv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`;return e.setAttribute("data-orphy-id",r),{orphyId:r,selector:ye(e),boundingBox:{top:Math.round(o.top),left:Math.round(o.left),width:Math.round(o.width),height:Math.round(o.height)},positionInElement:{x:Math.round(t-o.left),y:Math.round(n-o.top)},positionInViewport:{x:Math.round(t),y:Math.round(n)},viewport:{width:window.innerWidth,height:window.innerHeight,devicePixelRatio:window.devicePixelRatio},pageUrl:window.location.href}}let ve=null,xe=null,Ce=null,ke=null,Ae=null,Se=null,Ee=null,$e=null;const Ie="#C4A484",Ne="rgba(196, 164, 132, 0.15)",Me="rgba(196, 164, 132, 0.4)",Be="#6b7280",ze="#f3f4f6",Le="#10b981",Te="#d1fae5",je="#1f2937",Re="#6b7280",Oe="#9ca3af",Fe="#ffffff",De="#e5e7eb",He="rgba(0, 0, 0, 0.4)",Pe="#ef4444",We="#8b5cf6",Ve="#3b82f6",Ue="#f59e0b",qe="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif",Ye={xs:"11px",sm:"12px",base:"14px",lg:"15px"},Xe={bug:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${Pe}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>`,design:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${We}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r="0.5" fill="${We}"/><circle cx="17.5" cy="10.5" r="0.5" fill="${We}"/><circle cx="8.5" cy="7.5" r="0.5" fill="${We}"/><circle cx="6.5" cy="12.5" r="0.5" fill="${We}"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>`,content:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${Ve}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>`,question:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${Ue}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>`},_e='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',Je='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',Ze='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>';let Ke=!1;function Qe(e){const t=Date.now()-e,n=Math.floor(t/6e4),o=Math.floor(t/36e5),r=Math.floor(t/864e5),s=Math.floor(t/6048e5);return n<1?i("replay.timeAgo.now"):n<60?i("replay.timeAgo.minutes",{count:n}):o<24?i("replay.timeAgo.hours",{count:o}):r<7?i("replay.timeAgo.days",{count:r}):i("replay.timeAgo.weeks",{count:s})}function Ge(e,t){const n=u("span",{styles:t});return n.innerHTML=e,n}function et(e,t,n,o){tt(),function(){if(Ke)return;const e=document.createElement("style");e.id="orphy-replay-styles",e.textContent=`\n    @keyframes orphy-highlight-pulse {\n      0%, 100% { box-shadow: 0 0 0 4px ${Me}, 0 0 20px ${Me}; }\n      50% { box-shadow: 0 0 0 6px ${Me}, 0 0 30px ${Me}; }\n    }\n\n    @keyframes orphy-panel-slide-in {\n      from {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    @keyframes orphy-fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n\n    @keyframes orphy-success-pulse {\n      0% { transform: scale(1); }\n      50% { transform: scale(1.05); }\n      100% { transform: scale(1); }\n    }\n\n    .orphy-replay-overlay {\n      animation: orphy-fade-in 0.2s ease-out;\n    }\n\n    .orphy-replay-highlight {\n      animation: orphy-highlight-pulse 2s ease-in-out infinite;\n    }\n\n    .orphy-replay-panel {\n      animation: orphy-panel-slide-in 0.3s ease-out;\n    }\n\n    .orphy-replay-btn {\n      transition: all 0.15s ease;\n    }\n\n    .orphy-replay-btn:hover {\n      transform: translateY(-1px);\n    }\n\n    .orphy-replay-btn:active {\n      transform: translateY(0);\n    }\n\n    .orphy-replay-btn-primary:hover {\n      filter: brightness(1.05);\n      box-shadow: 0 4px 12px ${Me};\n    }\n\n    .orphy-replay-btn-secondary:hover {\n      background-color: ${De};\n    }\n\n    .orphy-replay-btn-success {\n      animation: orphy-success-pulse 0.3s ease;\n    }\n  `,document.head.appendChild(e),Ke=!0}(),ke=e,ve=u("div",{className:"orphy-replay-overlay",styles:{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:He,zIndex:"999998",cursor:"pointer"},onClick:n}),xe=u("div",{className:"orphy-replay-highlight",styles:{position:"fixed",pointerEvents:"none",zIndex:"999999",border:`3px solid ${Ie}`,backgroundColor:Ne,borderRadius:"6px"}}),Ce=function(e,t,n){const o="resolved"===e.status,r=(v=e.feedbackType,{bug:Pe,design:We,content:Ve,question:Ue}[v]),s=Ge(Xe[e.feedbackType],{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",backgroundColor:`${r}15`}),l=u("span",{styles:{fontSize:Ye.base,fontWeight:"600",color:je},children:[i(`types.${e.feedbackType}`)]}),a=u("div",{styles:{display:"flex",alignItems:"center",gap:"8px"},children:[s,l]}),d=u("span",{styles:{display:"inline-flex",alignItems:"center",padding:"3px 10px",borderRadius:"99px",fontSize:Ye.sm,fontWeight:"500",backgroundColor:o?Te:ze,color:o?Le:Be},children:[i(`replay.status.${e.status}`)]}),c=u("div",{styles:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"12px",borderBottom:`1px solid ${De}`,marginBottom:"16px"},children:[a,d]}),p=u("p",{styles:{margin:"0 0 16px",fontSize:Ye.lg,lineHeight:"1.6",color:je,wordBreak:"break-word"},children:[e.comment]}),h=Ge(Je,{display:"flex",alignItems:"center",color:Oe}),m=u("span",{children:[Qe(e.createdAt??e.timestamp)]}),y=u("div",{styles:{display:"flex",alignItems:"center",gap:"6px"},children:[h,m]}),f=Ge(Ze,{display:"flex",alignItems:"center",color:Oe}),b=u("span",{children:[e.viewport?i("replay.viewport",{width:e.viewport.width,height:e.viewport.height,device:i("replay.device.desktop")}):"—"]}),g=u("div",{styles:{display:"flex",alignItems:"center",gap:"6px"},children:[f,b]}),w=u("div",{styles:{display:"flex",flexWrap:"wrap",gap:"16px",fontSize:Ye.sm,color:Re,paddingBottom:"16px",borderBottom:`1px solid ${De}`,marginBottom:"16px"},children:[y,g]});var v;let x=null,C=null;if(!o){x=u("textarea",{styles:{width:"100%",minHeight:"80px",padding:"12px",border:`1px solid ${De}`,borderRadius:"8px",fontSize:Ye.base,fontFamily:qe,resize:"vertical",boxSizing:"border-box",color:je,backgroundColor:Fe},attributes:{placeholder:i("replay.notePlaceholder")}}),x.addEventListener("focus",()=>{x.style.borderColor=Ie,x.style.outline="none",x.style.boxShadow=`0 0 0 3px ${Ne}`}),x.addEventListener("blur",()=>{x.style.borderColor=De,x.style.boxShadow="none"});const e=u("p",{styles:{margin:"6px 0 0",fontSize:Ye.xs,color:Oe},children:[i("replay.noteHint")]});C=u("div",{styles:{marginBottom:"16px"},children:[x,e]})}const k=u("button",{className:"orphy-replay-btn orphy-replay-btn-secondary",styles:{padding:"10px 18px",border:"none",borderRadius:"8px",backgroundColor:ze,color:je,fontSize:Ye.base,fontWeight:"500",cursor:"pointer",fontFamily:qe},onClick:e=>{e.stopPropagation(),t()},children:[i("replay.close")]});$e=u("button",{className:"orphy-replay-btn orphy-replay-btn-primary",styles:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 18px",border:"none",borderRadius:"8px",backgroundColor:Ie,color:"#ffffff",fontSize:Ye.base,fontWeight:"500",cursor:"pointer",fontFamily:qe},onClick:async o=>{o.stopPropagation();const r=x?.value.trim()||void 0;await async function(e,t,n,o){if(!$e)return;$e.disabled=!0,$e.textContent=i("replay.resolving"),$e.style.opacity="0.7",$e.style.cursor="wait";try{await n(e,t);const r=Ge(_e,{display:"inline-flex",marginRight:"4px"});$e.textContent="",$e.appendChild(r),$e.appendChild(document.createTextNode(i("replay.resolved"))),$e.style.backgroundColor=Le,$e.style.opacity="1",$e.classList.add("orphy-replay-btn-success"),setTimeout(()=>{o()},600)}catch{$e.disabled=!1,$e.textContent=i("replay.resolve"),$e.style.opacity="1",$e.style.cursor="pointer"}}(e.id,r,n,t)},children:[i("replay.resolve")]});const A=u("div",{styles:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:o?[k]:[k,$e]}),S=u("div",{styles:{marginTop:"12px",fontSize:Ye.xs,color:Oe,textAlign:"center"},children:[i("replay.hint")]}),E=[c,p,w];C&&E.push(C);return E.push(A,S),u("div",{className:"orphy-replay-panel",styles:{position:"fixed",bottom:"24px",right:"24px",width:"360px",maxWidth:"calc(100vw - 48px)",backgroundColor:Fe,borderRadius:"12px",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",padding:"20px",zIndex:"999999",fontFamily:qe},children:E})}(t,n,o),document.body.appendChild(ve),document.body.appendChild(xe),document.body.appendChild(Ce),nt(),Ae=new ResizeObserver(ot),Ae.observe(e),window.addEventListener("scroll",ot,{passive:!0}),window.addEventListener("resize",ot,{passive:!0}),Ee=e=>{"Escape"===e.key&&(e.preventDefault(),n())},document.addEventListener("keydown",Ee)}function tt(){null!==Se&&(cancelAnimationFrame(Se),Se=null),Ae&&(Ae.disconnect(),Ae=null),Ee&&(document.removeEventListener("keydown",Ee),Ee=null),window.removeEventListener("scroll",ot),window.removeEventListener("resize",ot),ve?.remove(),xe?.remove(),Ce?.remove(),ve=null,xe=null,Ce=null,ke=null,$e=null}function nt(){if(!xe||!ke)return;const e=ke.getBoundingClientRect();xe.style.top=e.top-4+"px",xe.style.left=e.left-4+"px",xe.style.width=`${e.width+8}px`,xe.style.height=`${e.height+8}px`}function ot(){null===Se&&(Se=requestAnimationFrame(()=>{Se=null,nt()}))}let rt=!1,it=null;async function st(e){if(it){rt=!0;try{const t=await fetch(`${it.apiUrl}/${e}`);if(!t.ok)throw new Error(`Failed to fetch feedback: ${t.status}`);const{feedback:n}=await t.json();await new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",()=>e(),{once:!0})});let o=document.querySelector(`[data-orphy-id="${n.orphyId}"]`);if(o||(o=document.querySelector(n.selector)),!o)return void pt("Element not found on this page");o.scrollIntoView({block:"center",behavior:"instant"}),et(o,n,dt,ct)}catch(t){console.error("Orphy: Failed to enter replay mode",t),pt("Failed to load feedback")}}else console.error("Orphy: Replay config not set")}function lt(){rt=!1,tt(),ht();const e=new URL(window.location.href);e.searchParams.delete("orphy_replay"),window.history.replaceState({},"",e.toString())}function at(){return rt}function dt(){lt()}async function ct(e,t){if(it)try{const n=await fetch(`${it.apiUrl}/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"resolved",resolutionNote:t})});if(!n.ok)throw new Error(`Failed to update status: ${n.status}`);lt()}catch(n){console.error("Orphy: Failed to mark as resolved",n)}}let ut=null;function pt(e){ht(),ut=document.createElement("div"),ut.className="orphy-fallback",Object.assign(ut.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"999999",backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)",padding:"24px",textAlign:"center",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"});const t=document.createElement("p");t.textContent=e,t.style.margin="0 0 16px",t.style.fontSize="16px",t.style.color="#374151";const n=document.createElement("button");n.textContent="Close",Object.assign(n.style,{padding:"8px 16px",border:"none",borderRadius:"4px",backgroundColor:"#3b82f6",color:"#ffffff",fontSize:"14px",fontWeight:"500",cursor:"pointer"}),n.onclick=()=>lt(),ut.appendChild(t),ut.appendChild(n),document.body.appendChild(ut)}function ht(){ut&&(ut.remove(),ut=null)}function mt(){!function(){if(document.getElementById("orphy-marker-styles"))return;const e=document.createElement("style");e.id="orphy-marker-styles",e.textContent=`\n    /* Outline styles - active only when .orphy-mode is on body */\n    /* Badges are handled separately via JS layer for compatibility with void elements */\n    body.orphy-mode [data-orphy-annotated] {\n      cursor: pointer !important;\n      transition: box-shadow 0.2s ease-in-out, outline-color 0.2s ease-in-out;\n    }\n    body.orphy-mode [data-orphy-annotated="draft"] {\n      outline: 2px solid ${y.primary};\n      box-shadow:\n        0 0 0 2px rgba(255, 255, 255, 0.9),\n        0 0 0 4px rgba(0, 0, 0, 0.15),\n        0 0 12px rgba(212, 163, 115, 0.3);\n    }\n    body.orphy-mode [data-orphy-annotated="sending"] {\n      outline: 2px solid ${f.sending};\n      box-shadow:\n        0 0 0 2px rgba(255, 255, 255, 0.9),\n        0 0 0 4px rgba(0, 0, 0, 0.15),\n        0 0 12px rgba(201, 162, 39, 0.3);\n    }\n    body.orphy-mode [data-orphy-annotated="sent"] {\n      outline: 2px solid ${f.success};\n      box-shadow:\n        0 0 0 2px rgba(255, 255, 255, 0.9),\n        0 0 0 4px rgba(0, 0, 0, 0.15),\n        0 0 12px rgba(46, 139, 87, 0.3);\n    }\n    body.orphy-mode [data-orphy-annotated="error"] {\n      outline: 2px solid ${f.error};\n      box-shadow:\n        0 0 0 2px rgba(255, 255, 255, 0.9),\n        0 0 0 4px rgba(0, 0, 0, 0.15),\n        0 0 12px rgba(201, 68, 74, 0.3);\n    }\n\n    @keyframes orphy-flash {\n      0% { opacity: 1; }\n      50% { opacity: 0.5; }\n      100% { opacity: 1; }\n    }\n    .orphy-flash-highlight {\n      animation: orphy-flash 0.5s ease-in-out 3;\n    }\n  `,document.head.appendChild(e)}(),l.subscribe(yt)}function yt(){const e=l.getDrafts();ft();const t=new Map;e.forEach((e,n)=>{let o=e.element;if(!o.isConnected){const t=document.querySelector(e.selector);if(!t)return;e.element=t,o=t}const r=t.get(o)||{status:e.status,count:0,firstIndex:n+1};bt(e.status)>bt(r.status)&&(r.status=e.status),r.count++,t.set(o,r)}),t.forEach((e,t)=>{t.setAttribute("data-orphy-annotated",e.status),t.setAttribute("data-orphy-index",String(e.firstIndex)),e.count>1&&t.setAttribute("data-orphy-count",String(e.count))})}function ft(){document.querySelectorAll("[data-orphy-annotated]").forEach(e=>{e.removeAttribute("data-orphy-annotated"),e.removeAttribute("data-orphy-index"),e.removeAttribute("data-orphy-count")})}function bt(e){switch(e){case"error":return 4;case"sending":return 3;case"draft":return 2;case"sent":return 1;default:return 0}}let gt=null,wt=null;const vt=new Map,xt={draft:y.primary,sending:f.sending,sent:f.success,error:f.error};function Ct(){if(!gt)return;const e=l.getDrafts(),t=new Map;e.forEach(e=>{let n=e.element;if(!n.isConnected){const t=document.querySelector(e.selector);if(!t)return;e.element=t,n=t}const o=t.get(e.orphyId);o?o.drafts.push(e):t.set(e.orphyId,{element:n,drafts:[e]})});const n=new Set(t.keys());vt.forEach((e,t)=>{n.has(t)||(e.remove(),vt.delete(t))}),t.forEach(({element:e,drafts:t},n)=>{const o=t.length;if(!t[0])return;const r=t.some(e=>"error"===e.status)?"error":t.some(e=>"sending"===e.status)?"sending":t.some(e=>"draft"===e.status)?"draft":"sent";let i=vt.get(n);i?(i.textContent=String(o),i.style.backgroundColor=xt[r]):(i=function(e,t){const n=document.createElement("div");return n.className="orphy-badge",n.textContent=String(e),Object.assign(n.style,{position:"absolute",width:"22px",height:"22px",borderRadius:N.full,backgroundColor:xt[t],color:h.inverse,fontSize:w.xs,fontWeight:v.semibold,fontFamily:g.sans,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"\n      0 0 0 2px rgba(255, 255, 255, 0.95),\n      0 0 0 3px rgba(0, 0, 0, 0.2),\n      0 2px 8px rgba(0, 0, 0, 0.25)\n    ".replace(/\s+/g," ").trim(),transition:"background-color 0.2s ease-out"}),n}(o,r),gt.appendChild(i),vt.set(n,i)),kt(i,e)})}function kt(e,t){const n=t.getBoundingClientRect();e.style.left=n.left-11+"px",e.style.top=n.top-11+"px"}function At(){null===wt&&(wt=requestAnimationFrame(()=>{wt=null,function(){const e=l.getDrafts(),t=new Set;e.forEach(e=>{if(t.has(e.orphyId))return;t.add(e.orphyId);const n=vt.get(e.orphyId);n&&e.element.isConnected&&kt(n,e.element)})}()}))}let St=null,Et=0,$t=[],It=null,Nt=null,Mt=null,Bt=null,zt=null,Lt=null,Tt=null,jt=null;function Rt(e){Ot(),$t=e.items,Et=e.initialIndex??0,Tt=e.onExpand,jt=e.onItemChange??null,St=u("div",{className:"orphy-minimized-bar",styles:{position:"fixed",bottom:E,left:"50%",transform:"translateX(-50%) translateY(20px)",maxWidth:"480px",height:"40px",backgroundColor:p.primary,border:`${M.thin} solid ${m.default}`,borderRadius:N.xl,boxShadow:B,zIndex:F,display:"inline-flex",alignItems:"center",gap:C,padding:`0 ${k}`,fontFamily:g.sans,opacity:"0",transition:`all ${T.slow} ${j.out}`}}),zt=qt(function(){const e=Yt(),t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m15 18-6-6 6-6"),e.appendChild(t),e}(),i("minimizedBar.previous"),Pt),Nt=u("span",{styles:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:N.full,fontSize:w.xs,fontWeight:v.medium,whiteSpace:"nowrap",flexShrink:"0"}}),Mt=u("div",{styles:{maxWidth:"200px",minWidth:"0",fontSize:w.sm,color:h.secondary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),Bt=u("span",{styles:{fontSize:w.xs,color:h.tertiary,whiteSpace:"nowrap",flexShrink:"0"}}),Lt=qt(function(){const e=Yt(),t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m9 18 6-6-6-6"),e.appendChild(t),e}(),i("minimizedBar.next"),Wt);const t=u("div",{styles:{width:M.thin,height:"24px",backgroundColor:m.default,flexShrink:"0"}}),n=qt(function(){const e=Yt(),t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m18 15-6-6-6 6"),e.appendChild(t),e}(),i("minimizedBar.expand"),Vt);return St.appendChild(zt),St.appendChild(Nt),St.appendChild(Mt),St.appendChild(Bt),St.appendChild(Lt),St.appendChild(t),St.appendChild(n),Dt(),Ht(),document.body.appendChild(St),setTimeout(()=>{St&&(St.style.transform="translateX(-50%) translateY(0)",St.style.opacity="1")},10),It=e=>{St&&("ArrowLeft"===e.key?(e.preventDefault(),Pt()):"ArrowRight"===e.key&&(e.preventDefault(),Wt()))},St.addEventListener("keydown",It),St.setAttribute("tabindex","0"),function(){if(!St)return;window.innerWidth<=480&&(St.style.left="16px",St.style.right="16px",St.style.maxWidth="none",St.style.transform="translateY(20px)",setTimeout(()=>{St&&(St.style.transform="translateY(0)",St.style.opacity="1")},10))}(),{destroy:Ot,updateItems:Ft}}function Ot(){if(!St)return;St.style.transform="translateX(-50%) translateY(20px)",St.style.opacity="0";const e=St;setTimeout(()=>{e.remove()},200),St=null,Nt=null,Mt=null,Bt=null,zt=null,Lt=null,It=null,Tt=null,jt=null,$t=[],Et=0}function Ft(e,t){$t=e,void 0!==t&&(Et=t),Et>=$t.length&&(Et=Math.max(0,$t.length-1)),Dt(),Ht()}function Dt(){const e=$t[Et];e&&Nt&&Mt&&Bt&&(Nt.textContent=e.typeLabel,Nt.style.backgroundColor=`${e.typeColor}15`,Nt.style.color=e.typeColor,Mt.textContent=e.comment,Bt.textContent=`${Et+1}/${$t.length}`)}function Ht(){const e=$t.length<=1;zt&&(zt.style.display=e?"none":"flex"),Lt&&(Lt.style.display=e?"none":"flex"),Bt&&(Bt.style.display=e?"none":"inline")}function Pt(){$t.length<=1||(Et=Et<=0?$t.length-1:Et-1,Dt(),Ut())}function Wt(){$t.length<=1||(Et=Et>=$t.length-1?0:Et+1,Dt(),Ut())}function Vt(){Tt?.()}function Ut(){const e=$t[Et];e&&jt?.(e,Et)}function qt(e,t,n){const o=u("button",{styles:{width:"24px",height:"24px",border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:"0",padding:"0",margin:"0",lineHeight:"0",transition:`all ${T.base} ${j.default}`},onClick:n,attributes:{title:t},children:[e]});return o.addEventListener("mouseenter",()=>{o.style.backgroundColor=p.secondary,o.style.color=h.primary}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor="transparent",o.style.color=h.tertiary}),o}function Yt(e=12){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.style.display="block",t.style.flexShrink="0",t}let Xt=null,_t=null,Jt=null,Zt=null,Kt=!1,Qt=null,Gt=null;function en(e){if(Xt)return;Gt&&(Gt.destroy(),Gt=null),Qt=e;const t=u("div",{className:"orphy-review-backdrop",styles:{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:b.backdrop,zIndex:R,opacity:"0",transition:`opacity ${T.slow} ${j.out}`},onClick:ln});Xt=u("div",{className:"orphy-review-panel",styles:{position:"fixed",top:"0",right:"0",width:V.width,height:"100vh",backgroundColor:p.primary,boxShadow:z,borderLeft:`${M.thin} solid ${m.default}`,zIndex:F,display:"flex",flexDirection:"column",fontFamily:g.sans,transform:"translateX(100%)",transition:`transform ${T.slow} ${j.out}`}});const n=function(){const e=u("h2",{styles:{margin:"0",fontSize:w.lg,fontWeight:v.semibold,color:h.primary},children:[i("reviewPanel.title")]}),t=u("p",{styles:{margin:`${C} 0 0`,fontSize:w.sm,color:h.secondary},children:[i("reviewPanel.subtitle")]}),n=u("button",{styles:{padding:C,border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${T.base} ${j.default}`},onClick:nn,attributes:{title:i("minimizedBar.minimize")},children:[gn()]});n.addEventListener("mouseenter",()=>{n.style.backgroundColor=p.secondary,n.style.color=h.primary}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="transparent",n.style.color=h.tertiary});const o=u("button",{styles:{padding:C,border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${T.base} ${j.default}`},onClick:ln,children:[dn()]});o.addEventListener("mouseenter",()=>{o.style.backgroundColor=p.secondary,o.style.color=h.primary}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor="transparent",o.style.color=h.tertiary});const r=u("div",{styles:{position:"absolute",top:S,right:S,display:"flex",alignItems:"center",gap:C},children:[n,o]});return u("div",{styles:{position:"relative",padding:E,borderBottom:`${M.thin} solid ${m.default}`},children:[e,t,r]})}();_t=u("div",{className:"orphy-review-list",styles:{flex:"1",overflowY:"auto",padding:S,display:"flex",flexDirection:"column",gap:A}});const o=function(){const e=l.getDraftCount(),t=u("button",{className:"orphy-cancel-btn",styles:{flex:"1",padding:A,border:`${M.thin} solid ${m.default}`,borderRadius:N.md,backgroundColor:p.primary,color:h.secondary,fontSize:w.sm,fontWeight:v.medium,fontFamily:g.sans,cursor:"pointer",transition:`all ${T.base} ${j.default}`},onClick:ln,children:[i("reviewPanel.cancel")]});t.addEventListener("mouseenter",()=>{Kt||(t.style.backgroundColor=p.secondary)}),t.addEventListener("mouseleave",()=>{t.style.backgroundColor=p.primary}),Zt=u("button",{className:"orphy-submit-btn",styles:{flex:"2",padding:A,border:"none",borderRadius:N.md,backgroundColor:e>0?h.primary:p.tertiary,color:e>0?h.inverse:h.tertiary,fontSize:w.sm,fontWeight:v.semibold,fontFamily:g.sans,cursor:e>0?"pointer":"not-allowed",transition:`all ${T.base} ${j.default}`,display:"flex",alignItems:"center",justifyContent:"center",gap:k},children:[e>0?i("reviewPanel.submitCount",{count:e}):i("reviewPanel.submit")]}),e>0&&(Zt.addEventListener("click",an),Zt.addEventListener("mouseenter",()=>{!Kt&&Zt&&(Zt.style.backgroundColor="#2d2d2a")}),Zt.addEventListener("mouseleave",()=>{!Kt&&Zt&&(Zt.style.backgroundColor=h.primary)}));const n=u("div",{styles:{display:"flex",gap:k},children:[t,Zt]});return Jt=u("div",{className:"orphy-panel-footer",styles:{padding:S,borderTop:`${M.thin} solid ${m.default}`,backgroundColor:p.secondary},children:[n]}),Jt}();Xt.appendChild(n),Xt.appendChild(_t),Xt.appendChild(o),document.body.appendChild(t),document.body.appendChild(Xt),setTimeout(()=>{t.style.opacity="1",Xt&&(Xt.style.transform="translateX(0)")},10),sn(),l.subscribe(sn)}function tn(){if(Gt&&(Gt.destroy(),Gt=null),!Xt)return;const e=document.querySelector(".orphy-review-backdrop"),t=window.innerWidth<=480;Xt.style.transform=t?"translateY(100%)":"translateX(100%)",e instanceof HTMLElement&&(e.style.opacity="0"),setTimeout(()=>{Xt?.remove(),e?.remove(),Xt=null,_t=null,Jt=null,Zt=null,Kt=!1,Qt=null},300)}function nn(){if(!Xt)return;const e=Qt,t=l.getDrafts(),n=t.map(e=>{return{id:e.tempId,typeLabel:i(`types.${e.feedbackType}`),typeColor:(t=e.feedbackType,wn[t]),comment:e.comment};var t}),o=document.querySelector(".orphy-review-backdrop"),r=window.innerWidth<=480;Xt.style.transform=r?"translateY(100%)":"translateX(100%)",o instanceof HTMLElement&&(o.style.opacity="0"),setTimeout(()=>{Xt?.remove(),o?.remove(),Xt=null,_t=null,Jt=null,Zt=null,Kt=!1},300),n.length>0&&(Gt=Rt({items:n,onExpand:()=>{e&&en(e)},onItemChange:e=>{const n=t.find(t=>t.tempId===e.id);n?.element?.isConnected&&(n.element.scrollIntoView({block:"center",behavior:"smooth"}),n.element.classList.add("orphy-flash-highlight"),setTimeout(()=>{n.element.classList.remove("orphy-flash-highlight")},1e3))}}))}function on(){Gt&&(Gt.destroy(),Gt=null)}function rn(e){if(Kt=e,Zt)if(e)Zt.innerHTML="",Zt.appendChild(bn()),Zt.appendChild(document.createTextNode(i("reviewPanel.sending"))),Zt.style.cursor="not-allowed",Zt.style.opacity="0.7";else{const e=l.getDraftCount();Zt.innerHTML=e>0?i("reviewPanel.submitCount",{count:e}):i("reviewPanel.submit"),Zt.style.cursor=e>0?"pointer":"not-allowed",Zt.style.opacity="1"}}function sn(){if(!_t)return;const e=l.getDrafts();for(;_t.firstChild;)_t.removeChild(_t.firstChild);if(0===e.length){const e=u("div",{styles:{textAlign:"center",padding:`${I} ${E}`,color:h.tertiary},children:[un(),u("p",{styles:{margin:`${A} 0 0`,fontSize:w.base,color:h.secondary},children:[i("reviewPanel.empty")]}),u("p",{styles:{margin:`${C} 0 0`,fontSize:w.sm},children:[i("reviewPanel.emptyHint")]})]});return void _t.appendChild(e)}e.forEach((e,t)=>{const n=function(e,t){const n=function(e){switch(e){case"sending":return{bgColor:f.sendingBg,color:f.sending};case"sent":return{bgColor:f.successBg,color:f.success};case"error":return{bgColor:f.errorBg,color:f.error};default:return{bgColor:y.soft,color:y.primary}}}(e.status),o=u("div",{styles:{width:"24px",height:"24px",borderRadius:N.full,backgroundColor:n.bgColor,color:n.color,fontSize:w.xs,fontWeight:v.semibold,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:"0"}});"sending"===e.status?o.appendChild(bn(12)):"sent"===e.status?o.appendChild(function(e=14){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2.5"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M20 6 9 17l-5-5"),t.appendChild(n),t}(12)):"error"===e.status?o.appendChild(function(e=14){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2.5"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M18 6 6 18"),t.appendChild(n);const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d","m6 6 12 12"),t.appendChild(o),t}(12)):o.textContent=String(t);const r=u("div",{styles:{display:"flex",alignItems:"center",gap:C,fontSize:w.xs,color:h.secondary,marginBottom:C},children:[fn(e.feedbackType),pn(e.feedbackType)]}),i=u("div",{styles:{fontSize:w.sm,color:h.primary,lineHeight:x.base},children:[e.comment]}),s=u("div",{styles:{flex:"1",minWidth:"0"},children:[r,i]}),a=u("button",{styles:{padding:C,border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",flexShrink:"0",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${T.base} ${j.default}`},onClick:()=>{return t=e.tempId,void l.removeDraft(t);var t},children:[cn()]});a.addEventListener("mouseenter",()=>{a.style.backgroundColor=f.errorBg,a.style.color=f.error}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="transparent",a.style.color=h.tertiary});const d=u("div",{className:"orphy-draft-item",styles:{display:"flex",gap:A,padding:A,border:`${M.thin} solid ${m.default}`,borderRadius:N.lg,backgroundColor:p.primary,cursor:"pointer",transition:`all ${T.base} ${j.default}`},children:[o,s,a],onClick:t=>{if(t.target.closest("button"))return;const n=e.element;n&&n.isConnected&&(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add("orphy-flash-highlight"),setTimeout(()=>{n.classList.remove("orphy-flash-highlight")},1e3))}});return d.addEventListener("mouseenter",()=>{d.style.backgroundColor=p.secondary,d.style.borderColor=m.hover}),d.addEventListener("mouseleave",()=>{d.style.backgroundColor=p.primary,d.style.borderColor=m.default}),d}(e,t+1);_t.appendChild(n)})}function ln(){tn()}function an(){const e=l.getDrafts().filter(e=>"draft"===e.status);0!==e.length&&Qt?.(e)}function dn(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","18"),e.setAttribute("height","18"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1","18"),t.setAttribute("y1","6"),t.setAttribute("x2","6"),t.setAttribute("y2","18"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttribute("x1","6"),n.setAttribute("y1","6"),n.setAttribute("x2","18"),n.setAttribute("y2","18"),e.appendChild(n),e}function cn(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","14"),e.setAttribute("height","14"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M3 6h18"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"),e.appendChild(n),e}function un(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","48"),e.setAttribute("height","48"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.opacity="0.3";const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"),e.appendChild(t),e}function pn(e){return i(`types.${e}`)}function hn(e=12){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t}function mn(e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t}function yn(e,t,n,o){const r=document.createElementNS("http://www.w3.org/2000/svg","circle");return r.setAttribute("cx",String(e)),r.setAttribute("cy",String(t)),r.setAttribute("r",String(n)),o&&r.setAttribute("fill",o),r}function fn(e){switch(e){case"bug":return function(){const e=hn();return e.appendChild(mn("m8 2 1.88 1.88")),e.appendChild(mn("M14.12 3.88 16 2")),e.appendChild(mn("M9 7.13v-1a3.003 3.003 0 1 1 6 0v1")),e.appendChild(mn("M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6")),e.appendChild(mn("M12 20v-9")),e.appendChild(mn("M6.53 9C4.6 8.8 3 7.1 3 5")),e.appendChild(mn("M6 13H2")),e.appendChild(mn("M3 21c0-2.1 1.7-3.9 3.8-4")),e.appendChild(mn("M20.97 5c0 2.1-1.6 3.8-3.5 4")),e.appendChild(mn("M22 13h-4")),e.appendChild(mn("M17.2 17c2.1.1 3.8 1.9 3.8 4")),e}();case"design":return function(){const e=hn();return e.appendChild(yn(13.5,6.5,.5,"currentColor")),e.appendChild(yn(17.5,10.5,.5,"currentColor")),e.appendChild(yn(8.5,7.5,.5,"currentColor")),e.appendChild(yn(6.5,12.5,.5,"currentColor")),e.appendChild(mn("M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z")),e}();case"content":return function(){const e=hn();return e.appendChild(mn("M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z")),e.appendChild(mn("M14 2v4a2 2 0 0 0 2 2h4")),e.appendChild(mn("M10 9H8")),e.appendChild(mn("M16 13H8")),e.appendChild(mn("M16 17H8")),e}();case"question":return function(){const e=hn();return e.appendChild(yn(12,12,10)),e.appendChild(mn("M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3")),e.appendChild(mn("M12 17h.01")),e}()}}function bn(e=14){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","12"),n.setAttribute("cy","12"),n.setAttribute("r","10"),n.setAttribute("stroke-opacity","0.25"),t.appendChild(n);const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d","M12 2a10 10 0 0 1 10 10"),t.appendChild(o),t.style.animation="orphy-spin 1s linear infinite",t}function gn(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","18"),e.setAttribute("height","18"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m6 9 6 6 6-6"),e.appendChild(t),e}const wn={bug:"#ef4444",design:"#8b5cf6",content:"#3b82f6",question:"#f59e0b"};let vn=null,xn=null,Cn=null,kn=null,An=null,Sn=null,En=null,$n=null,In=null;const Nn={position:"fixed",bottom:H.bottom,right:H.right,zIndex:F,fontFamily:g.sans,display:"flex",gap:k,alignItems:"flex-end",flexDirection:"column"},Mn={display:"flex",alignItems:"center",gap:k,padding:P.padding.md,border:`${M.thin} solid ${m.default}`,borderRadius:N.lg,cursor:"pointer",fontSize:w.base,fontWeight:v.medium,fontFamily:g.sans,boxShadow:B,transition:`all ${T.base} ${j.default}`,outline:"none"},Bn={...Mn,backgroundColor:p.primary,color:h.primary},zn={backgroundColor:p.secondary,borderColor:m.hover},Ln={...Mn,backgroundColor:h.primary,color:h.inverse,borderColor:h.primary},Tn={backgroundColor:"#2d2d2a"},jn={...Mn,backgroundColor:p.primary,color:h.primary,display:"none"},Rn={backgroundColor:p.secondary,borderColor:m.hover},On={...Mn,backgroundColor:p.primary,color:h.primary},Fn={backgroundColor:p.secondary,borderColor:m.hover},Dn={minWidth:U.size,height:U.size,borderRadius:N.full,backgroundColor:y.primary,color:h.inverse,fontSize:U.fontSize,fontWeight:v.semibold,display:"flex",alignItems:"center",justifyContent:"center",padding:`0 ${C}`,marginLeft:C};function Hn(e,n,o){vn||(En=e,$n=n,In=o??null,xn=u("button",{className:"orphy-toolbar-btn",styles:Bn,onClick:Pn,children:[Yn(),i("toolbar.feedback")]}),Jn(xn,!1),Cn=function(){An=u("span",{className:"orphy-counter-badge",styles:Dn,children:["0"]});const e=u("button",{className:"orphy-review-btn",styles:jn,onClick:Wn,children:[Xn(),i("toolbar.review"),An]});return e.addEventListener("mouseenter",()=>{"none"!==e.style.display&&Object.assign(e.style,Rn)}),e.addEventListener("mouseleave",()=>{"none"!==e.style.display&&Object.assign(e.style,jn,{display:"flex"})}),e}(),kn=function(){Sn=u("span",{className:"orphy-messages-badge",styles:Dn,children:["0"]}),Sn.style.display="none";const e=u("button",{className:"orphy-messages-btn",styles:On,onClick:Vn,children:[_n(),i("toolbar.messages"),Sn]});return e.addEventListener("mouseenter",()=>{Object.assign(e.style,Fn)}),e.addEventListener("mouseleave",()=>{Object.assign(e.style,On)}),e}(),vn=u("div",{className:"orphy-toolbar",styles:Nn,children:[Cn,kn,xn]}),document.body.appendChild(vn),t.subscribe(Un),t.subscribe(qn),l.subscribe(qn))}function Pn(){const{active:e}=t.getState();En?.(!e)}function Wn(){$n?.()}function Vn(){In?.()}function Un(e){if(!xn)return;const t=e.active?Ln:Bn;Object.assign(xn.style,t),Jn(xn,e.active),xn.textContent="",xn.appendChild(Yn()),xn.appendChild(document.createTextNode(e.active?i("toolbar.done"):i("toolbar.feedback")))}function qn(){if(!Cn||!An)return;const{active:e}=t.getState(),n=l.getDraftCount();e&&n>0?(Cn.style.display="flex",An.textContent=String(n)):Cn.style.display="none"}function Yn(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"),e.appendChild(t),e}function Xn(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M9 11l3 3L22 4"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"),e.appendChild(n),e}function _n(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"),e.appendChild(t),e}function Jn(e,t){const n=e.cloneNode(!0);e.parentNode?.replaceChild(n,e),xn=n,n.addEventListener("click",Pn),n.addEventListener("mouseenter",()=>{Object.assign(n.style,t?Tn:zn)}),n.addEventListener("mouseleave",()=>{Object.assign(n.style,t?Ln:Bn)})}let Zn=null,Kn=[],Qn=0;async function Gn(){if(!Zn)return console.error("Orphy: Threads config not set"),[];const e=Date.now();if(Kn.length>0&&e-Qn<3e4)return Kn;const t=window.location.href.split("?")[0]??window.location.href;try{const n=await fetch(`${Zn.apiUrl}/project/${Zn.projectId}?pageUrl=${encodeURIComponent(t)}`);if(!n.ok)throw new Error(`Failed to fetch threads: ${n.status}`);const{feedbacks:o}=await n.json(),r=await Promise.all(o.map(async e=>{const t=await async function(e){if(!Zn)return[];try{const t=Zn.apiUrl.replace("/review","/replay"),n=await fetch(`${t}/${e}/replies`);if(!n.ok)return[];const{replies:o}=await n.json();return o}catch{return[]}}(e.id);return{...e,replies:t}}));return Kn=r,Qn=e,r}catch(n){return console.error("Orphy: Failed to fetch threads",n),[]}}let eo=!1;function to(e){eo=!1;let t=null;e.noBackdrop||(t=u("div",{className:"orphy-slide-panel-backdrop",styles:{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:b.backdrop,zIndex:R,opacity:"0",transition:`opacity ${T.slow} ${j.out}`},onClick:r}),document.body.appendChild(t));const n=u("div",{className:"orphy-slide-panel",styles:{position:"fixed",top:"0",right:"0",width:V.width,maxWidth:"100vw",height:"100vh",backgroundColor:p.primary,boxShadow:z,borderLeft:`${M.thin} solid ${m.default}`,zIndex:F,display:"flex",flexDirection:"column",fontFamily:g.sans,transform:"translateX(100%)",transition:`transform ${T.slow} ${j.out}`}}),o=e=>{"Escape"===e.key&&(e.preventDefault(),r())};function r(){if(eo)return;eo=!0;const r=window.innerWidth<=480;n.style.transform=r?"translateY(100%)":"translateX(100%)",t&&(t.style.opacity="0"),setTimeout(()=>{document.removeEventListener("keydown",o),t?.remove(),n.remove(),e.onClose()},200)}return document.body.appendChild(n),document.addEventListener("keydown",o),setTimeout(()=>{eo||(t&&(t.style.opacity="1"),n.style.transform="translateX(0)")},10),{container:n,close:r,setContent:function(e){for(;n.firstChild;)n.removeChild(n.firstChild);e.forEach(e=>n.appendChild(e))},isOpen:function(){return!eo&&document.body.contains(n)}}}const no={bug:"#ef4444",design:"#8b5cf6",content:"#3b82f6",question:"#f59e0b"},oo={agency:"#8b5cf6",agencyBg:"#f3e8ff",client:y.primary,clientBg:y.soft},ro={open:{bg:"#fef3c7",color:"#d97706",label:"En attente"},treated:{bg:"#dbeafe",color:"#2563eb",label:"Traité"},validated:{bg:"#dcfce7",color:"#16a34a",label:"Validé"},resolved:{bg:"#dbeafe",color:"#2563eb",label:"Traité"}};let io=null,so="list",lo=null,ao=[],co=null,uo=null,po="list",ho=!1,mo=null,yo=null,fo=null,bo=null,go=null,wo=null,vo=null,xo=null;function Co(e,t){if(uo&&(uo.destroy(),uo=null),io?.isOpen())return ao=e,void Io();ao=e,so="list",lo=null,co=null,mo=t.onSelect,yo=t.onClose,fo=t.onBackToList??null,bo=t.onReplySubmit??null,io=to({onClose:So,noBackdrop:!0}),Io()}function ko(){uo&&(uo.destroy(),uo=null),io?.close()}function Ao(){uo&&(uo.destroy(),uo=null)}function So(){if(ho)return ho=!1,void Eo();uo&&(uo.destroy(),uo=null);const e=yo;Eo(),e?.()}function Eo(){xo&&(document.removeEventListener("keydown",xo),xo=null),io=null,so="list",lo=null,ao=[],co=null,go=null,wo=null,vo=null,mo=null,yo=null,fo=null,bo=null}function $o(){xo&&(document.removeEventListener("keydown",xo),xo=null),so="list",lo=null,go=null,wo=null,vo=null,fo?.(),Io()}function Io(){if(!io)return;const e=function(e){const t=u("h2",{styles:{margin:"0",fontSize:w.lg,fontWeight:v.semibold,color:h.primary},children:[i("toolbar.messages")||"Messages"]}),n=u("p",{styles:{margin:`${C} 0 0`,fontSize:w.sm,color:h.secondary},children:[`${e} conversation${e>1?"s":""}`]}),o=To(Oo(),i("minimizedBar.minimize"),()=>Lo()),r=To(jo(),"",()=>io?.close()),s=u("div",{styles:{position:"absolute",top:S,right:S,display:"flex",alignItems:"center",gap:C},children:[o,r]});return u("div",{styles:{position:"relative",padding:E,borderBottom:`${M.thin} solid ${m.default}`},children:[t,n,s]})}(ao.length),t=function(){const e=u("div",{className:"orphy-threads-list",styles:{flex:"1",overflowY:"auto",padding:S,display:"flex",flexDirection:"column",gap:A}});0===ao.length?e.appendChild(u("div",{styles:{textAlign:"center",padding:`${I} ${E}`,color:h.tertiary},children:[Do(),u("p",{styles:{margin:`${A} 0 0`,fontSize:w.base,color:h.secondary},children:[i("reviewPanel.empty")||"No messages yet"]})]})):ao.forEach(t=>{e.appendChild(function(e){const t=e.replies.length>0,n=t?e.replies[e.replies.length-1]:null,o=co===e.id,r=u("div",{className:"orphy-thread-item",styles:{padding:A,backgroundColor:o?y.soft:p.primary,border:`${M.thin} solid ${o?y.primary:m.default}`,borderRadius:N.lg,cursor:"pointer",transition:`all ${T.base} ${j.default}`}});r.dataset.threadId=e.id;const s=no[e.feedbackType],l=u("span",{styles:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",borderRadius:N.full,fontSize:w.xs,fontWeight:v.medium,backgroundColor:`${s}15`,color:s}});l.appendChild(Po(e.feedbackType)),l.appendChild(document.createTextNode(i(`types.${e.feedbackType}`)||e.feedbackType));const a=u("div",{styles:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:k},children:[l,u("span",{styles:{fontSize:w.xs,color:h.tertiary},children:[Wo(e.createdAt??e.timestamp)]})]}),d=u("p",{styles:{margin:`0 0 ${k}`,fontSize:w.sm,color:h.primary,lineHeight:x.base,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",webkitLineClamp:"2",webkitBoxOrient:"vertical"},children:[e.comment]}),c=u("div",{styles:{display:"flex",alignItems:"center",gap:k}}),f=e.status||"open",b=ro[f]||ro.open,g=u("span",{styles:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 6px",borderRadius:N.md,fontSize:w.xs,fontWeight:v.medium,backgroundColor:b.bg,color:b.color}});if(g.appendChild(Fo(f)),g.appendChild(document.createTextNode(b.label)),c.appendChild(g),t&&n){const t=u("span",{styles:{display:"inline-flex",alignItems:"center",padding:"2px 6px",borderRadius:N.md,fontSize:w.xs,backgroundColor:"agency"===n.authorType?"#f3e8ff":y.soft,color:"agency"===n.authorType?"#8b5cf6":y.primary},children:[`${e.replies.length} ${e.replies.length>1?"replies":"reply"}`]});c.appendChild(t)}return r.appendChild(a),r.appendChild(d),r.appendChild(c),r.addEventListener("mouseenter",()=>{co!==e.id&&(r.style.backgroundColor=p.secondary,r.style.borderColor=m.hover)}),r.addEventListener("mouseleave",()=>{co!==e.id&&(r.style.backgroundColor=p.primary,r.style.borderColor=m.default)}),r.addEventListener("click",()=>{!function(e){so="detail",lo=e,co=e.id,mo?.(e),No()}(e)}),r}(t))});return e}();io.setContent([e,t])}function No(){if(!io||!lo)return;const e=function(e){const t=no[e.feedbackType],n=u("button",{styles:{width:"28px",height:"28px",border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.secondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginRight:k,transition:`all ${T.base} ${j.default}`},onClick:$o,children:[Ro()]});n.addEventListener("mouseenter",()=>{n.style.backgroundColor=p.secondary,n.style.color=h.primary}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="transparent",n.style.color=h.secondary});const o=Po(e.feedbackType),r=u("span",{styles:{fontSize:w.sm,fontWeight:v.semibold,color:t},children:[i(`types.${e.feedbackType}`)]}),s=u("div",{styles:{display:"flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:N.lg,backgroundColor:`${t}15`},children:[o,r]}),l=u("div",{styles:{display:"flex",alignItems:"center"},children:[n,s]}),a=u("span",{styles:{fontSize:w.xs,color:h.tertiary},children:[Wo(e.createdAt??e.timestamp)]}),d=u("button",{styles:{width:"28px",height:"28px",border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:k,transition:`all ${T.base} ${j.default}`},onClick:()=>Lo(),attributes:{title:i("minimizedBar.minimize")},children:[Oo()]});d.addEventListener("mouseenter",()=>{d.style.backgroundColor=p.secondary,d.style.color=h.primary}),d.addEventListener("mouseleave",()=>{d.style.backgroundColor="transparent",d.style.color=h.tertiary});const c=u("button",{styles:{width:"28px",height:"28px",border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:C,transition:`all ${T.base} ${j.default}`},onClick:()=>io?.close(),children:[jo()]});c.addEventListener("mouseenter",()=>{c.style.backgroundColor=p.secondary,c.style.color=h.primary}),c.addEventListener("mouseleave",()=>{c.style.backgroundColor="transparent",c.style.color=h.tertiary});const y=u("div",{styles:{display:"flex",alignItems:"center"},children:[a,d,c]});return u("div",{styles:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:S,borderBottom:`${M.thin} solid ${m.default}`},children:[l,y]})}(lo),t=function(e){const t="agency"===e.authorType,n=u("span",{styles:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:N.md,fontSize:w.xs,fontWeight:v.medium,backgroundColor:t?oo.agencyBg:oo.clientBg,color:t?oo.agency:oo.client},children:[i("thread.author."+(t?"agency":"client"))]}),o=e.status||"open",r=ro[o]||ro.open,s=u("span",{styles:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",borderRadius:N.md,fontSize:w.xs,fontWeight:v.medium,backgroundColor:r.bg,color:r.color,marginLeft:k}});s.appendChild(Fo(o)),s.appendChild(document.createTextNode(r.label));const l=u("div",{styles:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:k},children:[n,s]}),a=u("p",{styles:{margin:`${k} 0 0`,fontSize:w.base,lineHeight:x.relaxed,color:h.primary,wordBreak:"break-word"},children:[e.comment]}),d=u("div",{styles:{padding:S,backgroundColor:p.secondary,borderBottom:`${M.thin} solid ${m.default}`},children:[l,a]});if("treated"===o||"resolved"===o){const t=function(e){const t=u("div",{styles:{marginTop:A,paddingTop:A,borderTop:`${M.thin} solid ${m.default}`}}),n=u("p",{styles:{margin:`0 0 ${k}`,fontSize:w.sm,color:h.secondary},children:[i("thread.validateInfo")||"L'agence a traité ce retour. Confirmez si c'est résolu :"]}),o=u("button",{styles:{display:"inline-flex",alignItems:"center",gap:k,padding:`${k} ${S}`,border:"none",borderRadius:N.lg,backgroundColor:ro.validated.color,color:h.inverse,fontSize:w.sm,fontWeight:v.medium,cursor:"pointer",fontFamily:g.sans,transition:`all ${T.base} ${j.default}`},children:[Mo(),i("thread.validate")||"Valider"]});return o.addEventListener("mouseenter",()=>{o.style.backgroundColor="#15803d"}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor=ro.validated.color}),o.addEventListener("click",async()=>{o.disabled=!0,o.style.opacity="0.6",o.style.cursor="not-allowed",o.textContent=i("thread.validating")||"Validation...";const t=await async function(e){if(!Zn)return!1;try{const t=Zn.apiUrl.replace("/review","/replay"),n=await fetch(`${t}/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"validated"})});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.error||`Failed to validate: ${n.status}`)}const o=Kn.find(t=>t.id===e);return o&&(o.status="validated"),!0}catch(t){return console.error("Orphy: Failed to validate feedback",t),!1}}(e.id);t?(e.status="validated",No()):(o.disabled=!1,o.style.opacity="1",o.style.cursor="pointer",o.textContent=i("thread.validate")||"Valider")}),t.appendChild(n),t.appendChild(o),t}(e);d.appendChild(t)}return d}(lo),n=function(e){if(go=u("div",{className:"orphy-thread-detail-replies",styles:{flex:"1",overflowY:"auto",padding:S}}),0===e.length){const e=u("div",{styles:{padding:`${$} 0`,textAlign:"center",color:h.tertiary,fontSize:w.sm},children:[i("thread.noReplies")]});go.appendChild(e)}else e.forEach(e=>{go.appendChild(Bo(e))});return go}(lo.replies),o=function(){wo=u("textarea",{styles:{width:"100%",minHeight:"60px",maxHeight:"120px",padding:A,border:`${M.thin} solid ${m.default}`,borderRadius:N.lg,fontSize:w.sm,fontFamily:g.sans,resize:"vertical",boxSizing:"border-box",color:h.primary,backgroundColor:p.primary,transition:`all ${T.base} ${j.default}`},attributes:{placeholder:i("thread.replyPlaceholder")}}),wo.addEventListener("focus",()=>{wo&&(wo.style.borderColor=y.primary,wo.style.boxShadow=L)}),wo.addEventListener("blur",()=>{wo&&(wo.style.borderColor=m.default,wo.style.boxShadow="none")}),vo=u("button",{styles:{display:"flex",alignItems:"center",gap:k,padding:`${k} ${A}`,border:"none",borderRadius:N.lg,backgroundColor:y.primary,color:h.inverse,fontSize:w.sm,fontWeight:v.medium,cursor:"pointer",fontFamily:g.sans,transition:`all ${T.base} ${j.default}`},onClick:zo,children:[Ho(),i("thread.send")]}),vo.addEventListener("mouseenter",()=>{vo&&!vo.disabled&&(vo.style.backgroundColor=y.hover)}),vo.addEventListener("mouseleave",()=>{vo&&!vo.disabled&&(vo.style.backgroundColor=y.primary)});const e=u("div",{styles:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:k},children:[u("span",{styles:{fontSize:w.xs,color:h.tertiary},children:["⌘Enter "+i("thread.send").toLowerCase()]}),vo]});return u("div",{styles:{padding:S,borderTop:`${M.thin} solid ${m.default}`,backgroundColor:p.secondary},children:[wo,e]})}();io.setContent([e,t,n,o]),xo=e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&wo&&(e.preventDefault(),zo())},document.addEventListener("keydown",xo)}function Mo(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="block",e.style.flexShrink="0";const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M20 6 9 17l-5-5"),e.appendChild(t),e}function Bo(e){const t="agency"===e.authorType,n=u("span",{styles:{display:"inline-flex",alignItems:"center",padding:"2px 6px",borderRadius:N.md,fontSize:w.xs,fontWeight:v.medium,backgroundColor:t?oo.agencyBg:oo.clientBg,color:t?oo.agency:oo.client},children:[e.authorName??i("thread.author."+(t?"agency":"client"))]}),o=u("span",{styles:{fontSize:w.xs,color:h.tertiary},children:[Wo(e.createdAt)]}),r=u("div",{styles:{display:"flex",alignItems:"center",justifyContent:t?"flex-end":"flex-start",gap:k,marginBottom:C},children:t?[o,n]:[n,o]}),s=u("p",{styles:{margin:"0",fontSize:w.sm,lineHeight:x.base,color:h.primary,wordBreak:"break-word",textAlign:t?"right":"left"},children:[e.content]}),l=u("div",{styles:{padding:A,borderRadius:N.lg,backgroundColor:t?oo.agencyBg:p.secondary,maxWidth:"85%"},children:[r,s]});return u("div",{styles:{padding:`${k} 0`,display:"flex",justifyContent:t?"flex-end":"flex-start"},children:[l]})}async function zo(){if(!(wo&&vo&&lo&&bo))return;const e=wo.value.trim();if(!e)return;wo.disabled=!0,vo.disabled=!0,vo.style.opacity="0.6",vo.style.cursor="not-allowed";const t=vo.textContent;vo.textContent=i("thread.sending");try{const t=await bo(lo.id,e);if(t){wo.value="";const e=go?.querySelector("div[style*='text-align: center']");if(e&&e.remove(),go){const e=Bo(t);go.appendChild(e),go.scrollTop=go.scrollHeight}}}finally{wo&&(wo.disabled=!1),vo&&(vo.disabled=!1,vo.style.opacity="1",vo.style.cursor="pointer",vo.textContent=t)}}function Lo(){if(!io)return;po=so;const e=[...ao],t=lo,n=mo,o=yo,r=fo,s=bo,l=e.map(e=>{const t=e.status||"open",n=ro[t]||ro.open;return{id:e.id,typeLabel:i(`types.${e.feedbackType}`),typeColor:no[e.feedbackType],comment:e.comment,statusLabel:n.label,statusColor:n.color,statusBg:n.bg}});let a=0;if(t){const n=e.findIndex(e=>e.id===t.id);n>=0&&(a=n)}ho=!0,io.close(),l.length>0&&(uo=Rt({items:l,initialIndex:a,onExpand:()=>{const i={onSelect:n,onClose:()=>{ko(),o?.()}};if(r&&(i.onBackToList=r),s&&(i.onReplySubmit=s),Co(e,i),"detail"===po&&t&&s){const n=e.find(e=>e.id===t.id);if(n){const e={onReplySubmit:s,onClose:()=>o?.()};r&&(e.onBack=r),function(e,t){if(!io?.isOpen())return ao=[e],lo=e,so="detail",yo=t.onClose,bo=t.onReplySubmit,io=to({onClose:So,noBackdrop:!0}),void No();lo=e,so="detail",bo=t.onReplySubmit,No()}(n,e)}}},onItemChange:t=>{const o=e.find(e=>e.id===t.id);o&&n?.(o)}}))}function To(e,t,n){const o=u("button",{styles:{padding:C,border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${T.base} ${j.default}`},onClick:n,attributes:t?{title:t}:{},children:[e]});return o.addEventListener("mouseenter",()=>{o.style.backgroundColor=p.secondary,o.style.color=h.primary}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor="transparent",o.style.color=h.tertiary}),o}function jo(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","18"),e.setAttribute("height","18"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="block",e.style.flexShrink="0";const t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1","18"),t.setAttribute("y1","6"),t.setAttribute("x2","6"),t.setAttribute("y2","18"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttribute("x1","6"),n.setAttribute("y1","6"),n.setAttribute("x2","18"),n.setAttribute("y2","18"),e.appendChild(n),e}function Ro(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="block",e.style.flexShrink="0";const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m15 18-6-6 6-6"),e.appendChild(t),e}function Oo(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","18"),e.setAttribute("height","18"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="block",e.style.flexShrink="0";const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m6 9 6 6 6-6"),e.appendChild(t),e}function Fo(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("width","12"),t.setAttribute("height","12"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2.5"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.style.display="block",t.style.flexShrink="0","open"===e){const e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx","12"),e.setAttribute("cy","12"),e.setAttribute("r","10"),t.appendChild(e);const n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points","12 6 12 12 16 14"),t.appendChild(n)}else{const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M20 6 9 17l-5-5"),t.appendChild(e)}return t}function Do(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","48"),e.setAttribute("height","48"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="block",e.style.opacity="0.3";const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"),e.appendChild(t),e}function Ho(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","14"),e.setAttribute("height","14"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="block",e.style.flexShrink="0";const t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1","22"),t.setAttribute("y1","2"),t.setAttribute("x2","11"),t.setAttribute("y2","13"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","polygon");return n.setAttribute("points","22 2 15 22 11 13 2 9 22 2"),e.appendChild(n),e}function Po(e){const t=no[e],n=document.createElementNS("http://www.w3.org/2000/svg","svg");switch(n.setAttribute("width","14"),n.setAttribute("height","14"),n.setAttribute("viewBox","0 0 24 24"),n.setAttribute("fill","none"),n.setAttribute("stroke",t),n.setAttribute("stroke-width","2"),n.setAttribute("stroke-linecap","round"),n.setAttribute("stroke-linejoin","round"),n.style.display="block",n.style.flexShrink="0",e){case"bug":["m8 2 1.88 1.88","M14.12 3.88 16 2","M9 7.13v-1a3.003 3.003 0 1 1 6 0v1","M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6","M12 20v-9","M6.53 9C4.6 8.8 3 7.1 3 5","M6 13H2","M3 21c0-2.1 1.7-3.9 3.8-4","M20.97 5c0 2.1-1.6 3.8-3.5 4","M22 13h-4","M17.2 17c2.1.1 3.8 1.9 3.8 4"].forEach(e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),n.appendChild(t)});break;case"design":{[{cx:"13.5",cy:"6.5",r:"0.5"},{cx:"17.5",cy:"10.5",r:"0.5"},{cx:"8.5",cy:"7.5",r:"0.5"},{cx:"6.5",cy:"12.5",r:"0.5"}].forEach(e=>{const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",e.cx),o.setAttribute("cy",e.cy),o.setAttribute("r",e.r),o.setAttribute("fill",t),n.appendChild(o)});const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"),n.appendChild(e);break}case"content":["M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z","M14 2v4a2 2 0 0 0 2 2h4","M10 9H8","M16 13H8","M16 17H8"].forEach(e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),n.appendChild(t)});break;case"question":{const e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx","12"),e.setAttribute("cy","12"),e.setAttribute("r","10"),n.appendChild(e);["M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3","M12 17h.01"].forEach(e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),n.appendChild(t)});break}}return n}function Wo(e){const t=Date.now()-e,n=Math.floor(t/6e4),o=Math.floor(t/36e5),r=Math.floor(t/864e5);return n<1?i("replay.timeAgo.now"):n<60?i("replay.timeAgo.minutes",{count:n}):o<24?i("replay.timeAgo.hours",{count:o}):i("replay.timeAgo.days",{count:r})}let Vo=null,Uo=null,qo=null,Yo=null,Xo=null,_o=null,Jo=null,Zo=null,Ko=null,Qo=new Map,Go=null,er=null;const tr=["bug","design","content","question"],nr={position:"absolute",zIndex:D,backgroundColor:p.primary,borderRadius:N.xl,boxShadow:z,border:`${M.thin} solid ${m.default}`,padding:S,width:W.width,fontFamily:g.sans,maxHeight:"80vh",overflowY:"auto"},or={fontSize:w.sm,fontWeight:v.medium,color:h.secondary,marginBottom:A,display:"flex",alignItems:"center",gap:k},rr={overflow:"hidden",maxHeight:"0",opacity:"0",transition:`all ${T.base} ${j.out}`,marginTop:"0"},ir={maxHeight:"200px",opacity:"1",marginTop:A},sr={width:"100%",minHeight:"100px",padding:A,border:`${M.thin} solid ${m.default}`,borderRadius:N.md,fontSize:w.base,fontFamily:g.sans,lineHeight:x.relaxed,color:h.primary,backgroundColor:p.primary,resize:"vertical",boxSizing:"border-box",outline:"none",transition:`border-color ${T.base} ${j.default}, box-shadow ${T.base} ${j.default}`},lr={borderColor:y.primary,boxShadow:L},ar={borderColor:m.default,boxShadow:"none"},dr={display:"flex",gap:k,justifyContent:"flex-end",marginTop:A},cr={padding:P.padding.md,border:"none",borderRadius:N.md,fontSize:w.sm,fontWeight:v.medium,fontFamily:g.sans,cursor:"pointer",transition:`all ${T.base} ${j.default}`,outline:"none"},ur={...cr,backgroundColor:p.secondary,color:h.secondary,border:`${M.thin} solid ${m.default}`},pr={backgroundColor:p.tertiary,borderColor:m.hover},hr={...cr,backgroundColor:h.primary,color:h.inverse},mr={backgroundColor:"#2d2d2a"},yr={backgroundColor:p.tertiary,color:h.tertiary,cursor:"not-allowed"},fr={fontSize:w.xs,color:h.tertiary,marginTop:k,display:"flex",alignItems:"center",gap:C},br={display:"flex",gap:C,marginBottom:"0"},gr={display:"flex",alignItems:"center",gap:C,padding:`${C} ${k}`,border:`${M.thin} solid ${m.default}`,borderRadius:N.md,backgroundColor:p.primary,color:h.secondary,fontSize:w.xs,fontWeight:v.medium,fontFamily:g.sans,cursor:"pointer",transition:`all ${T.fast} ${j.default}`,outline:"none"},wr={backgroundColor:y.soft,borderColor:y.primary,color:h.primary},vr={borderColor:m.hover,backgroundColor:p.secondary},xr={marginBottom:A,display:"flex",flexDirection:"column",gap:k},Cr={display:"flex",alignItems:"flex-start",gap:k,padding:k,backgroundColor:p.secondary,borderRadius:N.md,border:`${M.thin} solid ${m.default}`},kr={flex:"1",minWidth:"0"},Ar={fontSize:w.xs,fontWeight:v.medium,color:h.secondary,display:"flex",alignItems:"center",gap:C,marginBottom:C},Sr={fontSize:w.sm,color:h.primary,lineHeight:x.base,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},Er={padding:C,border:"none",borderRadius:N.sm,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:"0",transition:`all ${T.fast} ${j.default}`},$r={display:"none",alignItems:"center",gap:C,padding:`${k} ${A}`,marginTop:A,border:`${M.thin} dashed ${m.default}`,borderRadius:N.md,backgroundColor:"transparent",color:h.secondary,fontSize:w.sm,fontWeight:v.medium,fontFamily:g.sans,cursor:"pointer",transition:`all ${T.fast} ${j.default}`,width:"100%",justifyContent:"center"},Ir={backgroundColor:p.secondary,borderColor:m.hover,color:h.primary};function Nr(e,n,o,r,s){Mr(),Jo=e,Go=r,er=s,Zo=null,Ko=null,Qo.clear(),Yo=null,Xo=null,qo=null,_o=null;const a=l.getDraftsByElement(e.orphyId),d=a.length>0,c=i(d?"commentBox.headerExisting":"commentBox.headerNew"),p=u("div",{styles:or,children:[Vr(),c]});d&&(_o=u("div",{className:"orphy-existing-drafts",styles:xr}),a.forEach(e=>{const t=Br(e);_o.appendChild(t)}));const h=u("div",{className:"orphy-type-selector",styles:br});tr.forEach(e=>{const t=i(`types.${e}`),n=u("button",{className:`orphy-type-btn orphy-type-${e}`,styles:{...gr},children:[Xr(e),t]});n.addEventListener("click",()=>zr(e)),n.addEventListener("mouseenter",()=>{e!==Zo&&Object.assign(n.style,vr)}),n.addEventListener("mouseleave",()=>{e!==Zo&&Object.assign(n.style,gr)}),Qo.set(e,n),h.appendChild(n)}),qo=u("div",{className:"orphy-textarea-container",styles:rr}),Uo=u("textarea",{className:"orphy-comment-textarea",styles:sr,attributes:{placeholder:i("commentBox.placeholder")}}),Uo.addEventListener("focus",()=>{Uo&&Object.assign(Uo.style,lr)}),Uo.addEventListener("blur",()=>{Uo&&Object.assign(Uo.style,ar)}),Uo.addEventListener("input",Dr),qo.appendChild(Uo),Xo=u("button",{className:"orphy-add-another",styles:$r,children:[qr(),i("commentBox.addAnother")],onClick:Lr}),Xo.addEventListener("mouseenter",()=>{Xo&&Object.assign(Xo.style,Ir)}),Xo.addEventListener("mouseleave",()=>{Xo&&Object.assign(Xo.style,{...$r,display:Xo.style.display})});const m=u("button",{className:"orphy-comment-cancel",styles:ur,onClick:Rr,children:[i("commentBox.cancel")]});var y,f,b;f=pr,b=ur,(y=m).addEventListener("mouseenter",()=>{Object.assign(y.style,f)}),y.addEventListener("mouseleave",()=>{Object.assign(y.style,b)}),Yo=u("button",{className:"orphy-comment-submit",styles:{...hr,...yr},onClick:jr,children:[i(d?"commentBox.submitExisting":"commentBox.submit")]}),Yo.disabled=!0,Yo.addEventListener("mouseenter",()=>{Yo&&!Yo.disabled&&Object.assign(Yo.style,mr)}),Yo.addEventListener("mouseleave",()=>{Yo&&!Yo.disabled&&Object.assign(Yo.style,hr)});const g=u("div",{styles:dr,children:[m,Yo]}),w=u("div",{styles:fr,children:[Ur(),i("commentBox.hint")]});Vo=u("div",{className:"orphy-comment-box",styles:nr,children:[p,_o,h,qo,Xo,g,w].filter(e=>null!==e)}),function(e,t){if(!Vo)return;const n=20,o=parseInt(W.width),r=window.scrollX,i=window.scrollY;let s=e+r+10,l=t+i+10;e+o+n>window.innerWidth&&(s=e+r-o-10);s<r+n&&(s=r+n);Vo.style.left=`${s}px`,Vo.style.top=`${l}px`}(n,o),document.body.appendChild(Vo),t.setState({commentBoxVisible:!0}),document.addEventListener("keydown",Or)}function Mr(){Vo&&(document.removeEventListener("keydown",Or),Vo.remove(),Vo=null,Uo=null,qo=null,Yo=null,Xo=null,_o=null,Jo=null,Go=null,er=null,Ko=null,Qo.clear(),t.setState({commentBoxVisible:!1}))}function Br(e){const t=u("div",{className:"orphy-draft-item",styles:Cr}),n=u("div",{styles:kr}),o=u("div",{styles:Ar,children:[Xr(e.feedbackType),(r=e.feedbackType,i(`types.${r}`))]});var r;const s=u("div",{styles:Sr,children:[e.comment]});s.title=e.comment,n.appendChild(o),n.appendChild(s),t.appendChild(n);const l=u("button",{styles:Er,children:[Yr()],onClick:()=>function(e){Ko=e.tempId,zr(e.feedbackType),Uo&&(Uo.value=e.comment);Fr(),Dr()}(e)});return l.addEventListener("mouseenter",()=>{l.style.backgroundColor=p.tertiary,l.style.color=h.primary}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor="transparent",l.style.color=h.tertiary}),t.appendChild(l),t}function zr(e){if(Zo){const e=Qo.get(Zo);e&&Object.assign(e.style,gr)}Zo=e;const t=Qo.get(e);t&&Object.assign(t.style,wr),qo&&(Object.assign(qo.style,ir),setTimeout(()=>Uo?.focus(),200)),Fr()}function Lr(){Tr(),function(){if(Zo){const e=Qo.get(Zo);e&&Object.assign(e.style,gr)}Zo=null,Ko=null,qo&&Object.assign(qo.style,rr);Uo&&(Uo.value="");Xo&&(Xo.style.display="none");Yo&&(Yo.disabled=!0,Object.assign(Yo.style,hr,yr))}()}function Tr(){const e=Uo?.value.trim();e&&Zo&&Jo&&(Ko?l.updateDraft(Ko,{comment:e,feedbackType:Zo}):Go?.(e,Jo,Zo),function(){if(!_o||!Jo){if(!_o&&Jo&&Vo){const e=l.getDraftsByElement(Jo.orphyId);if(e.length>0){_o=u("div",{className:"orphy-existing-drafts",styles:xr}),e.forEach(e=>{const t=Br(e);_o.appendChild(t)});const t=Vo.firstChild;t&&t.nextSibling&&Vo.insertBefore(_o,t.nextSibling)}}return}for(;_o.firstChild;)_o.removeChild(_o.firstChild);const e=l.getDraftsByElement(Jo.orphyId);e.forEach(e=>{const t=Br(e);_o.appendChild(t)}),e.length>0&&(_o.style.display="flex")}())}function jr(){const e=Uo?.value.trim();e&&Zo&&Tr(),Mr()}function Rr(){er?.(),Mr()}function Or(e){"Escape"===e.key?Rr():"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&Zo&&Uo?.value.trim()&&jr()}function Fr(){if(!Yo)return;const e=Boolean(Uo?.value.trim()),t=Boolean(Zo),n=Jo?l.getDraftsByElement(Jo.orphyId):[],o=t&&e||n.length>0&&!t;Yo.disabled=!o,o?Object.assign(Yo.style,hr):Object.assign(Yo.style,hr,yr)}function Dr(){if(!Xo||!Uo)return;const e=Boolean(Uo.value.trim()),t=Boolean(Zo);Xo.style.display=e&&t?"flex":"none",Fr()}function Hr(e=14){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t}function Pr(e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t}function Wr(e,t,n,o){const r=document.createElementNS("http://www.w3.org/2000/svg","circle");return r.setAttribute("cx",String(e)),r.setAttribute("cy",String(t)),r.setAttribute("r",String(n)),o&&r.setAttribute("fill",o),r}function Vr(){const e=Hr();return e.appendChild(Pr("M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z")),e}function Ur(){const e=Hr(12),t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x","2"),t.setAttribute("y","4"),t.setAttribute("width","20"),t.setAttribute("height","16"),t.setAttribute("rx","2"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","6"),n.setAttribute("y1","8"),n.setAttribute("x2","6"),n.setAttribute("y2","8"),e.appendChild(n);const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1","18"),o.setAttribute("y1","8"),o.setAttribute("x2","18"),o.setAttribute("y2","8"),e.appendChild(o);const r=document.createElementNS("http://www.w3.org/2000/svg","line");return r.setAttribute("x1","8"),r.setAttribute("y1","16"),r.setAttribute("x2","16"),r.setAttribute("y2","16"),e.appendChild(r),e}function qr(){const e=Hr();return e.appendChild(Pr("M5 12h14")),e.appendChild(Pr("M12 5v14")),e}function Yr(){const e=Hr();return e.appendChild(Pr("M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z")),e.appendChild(Pr("m15 5 4 4")),e}function Xr(e){switch(e){case"bug":return function(){const e=Hr();return e.appendChild(Pr("m8 2 1.88 1.88")),e.appendChild(Pr("M14.12 3.88 16 2")),e.appendChild(Pr("M9 7.13v-1a3.003 3.003 0 1 1 6 0v1")),e.appendChild(Pr("M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6")),e.appendChild(Pr("M12 20v-9")),e.appendChild(Pr("M6.53 9C4.6 8.8 3 7.1 3 5")),e.appendChild(Pr("M6 13H2")),e.appendChild(Pr("M3 21c0-2.1 1.7-3.9 3.8-4")),e.appendChild(Pr("M20.97 5c0 2.1-1.6 3.8-3.5 4")),e.appendChild(Pr("M22 13h-4")),e.appendChild(Pr("M17.2 17c2.1.1 3.8 1.9 3.8 4")),e}();case"design":return function(){const e=Hr();return e.appendChild(Wr(13.5,6.5,.5,"currentColor")),e.appendChild(Wr(17.5,10.5,.5,"currentColor")),e.appendChild(Wr(8.5,7.5,.5,"currentColor")),e.appendChild(Wr(6.5,12.5,.5,"currentColor")),e.appendChild(Pr("M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z")),e}();case"content":return function(){const e=Hr();return e.appendChild(Pr("M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z")),e.appendChild(Pr("M14 2v4a2 2 0 0 0 2 2h4")),e.appendChild(Pr("M10 9H8")),e.appendChild(Pr("M16 13H8")),e.appendChild(Pr("M16 17H8")),e}();case"question":return function(){const e=Hr();return e.appendChild(Wr(12,12,10)),e.appendChild(Pr("M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3")),e.appendChild(Pr("M12 17h.01")),e}()}}let _r=null;const Jr=new Map,Zr={success:4e3,error:0,info:3e3},Kr={success:{bgColor:p.primary,textColor:h.primary,iconColor:f.success},error:{bgColor:p.primary,textColor:h.primary,iconColor:f.error},info:{bgColor:p.primary,textColor:h.primary,iconColor:y.primary}};function Qr(e){!function(){if(_r)return;_r=u("div",{className:"orphy-toast-container",styles:{position:"fixed",bottom:E,left:E,zIndex:D,display:"flex",flexDirection:"column",gap:k,pointerEvents:"none"}}),document.body.appendChild(_r)}();const t=`toast_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,n=e.duration??Zr[e.type],o=Kr[e.type],r=u("div",{className:`orphy-toast orphy-toast-${e.type}`,styles:{display:"flex",alignItems:"flex-start",gap:k,padding:A,backgroundColor:o.bgColor,borderRadius:N.lg,boxShadow:B,border:`${M.thin} solid ${m.default}`,fontFamily:g.sans,fontSize:w.sm,color:o.textColor,maxWidth:"320px",opacity:"0",transform:"translateY(10px)",transition:`all ${T.base} ${j.out}`,pointerEvents:"auto"}}),i=function(e){switch(e){case"success":return function(){const e=ei(),t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx","12"),t.setAttribute("cy","12"),t.setAttribute("r","10"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","m9 12 2 2 4-4"),e.appendChild(n),e}();case"error":return function(){const e=ei(),t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx","12"),t.setAttribute("cy","12"),t.setAttribute("r","10"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","8"),n.setAttribute("x2","12"),n.setAttribute("y2","12"),e.appendChild(n);const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1","12"),o.setAttribute("y1","16"),o.setAttribute("x2","12.01"),o.setAttribute("y2","16"),e.appendChild(o),e}();case"info":return function(){const e=ei(),t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx","12"),t.setAttribute("cy","12"),t.setAttribute("r","10"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","16"),n.setAttribute("x2","12"),n.setAttribute("y2","12"),e.appendChild(n);const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1","12"),o.setAttribute("y1","8"),o.setAttribute("x2","12.01"),o.setAttribute("y2","8"),e.appendChild(o),e}()}}(e.type);i.style.color=o.iconColor,i.style.flexShrink="0",i.style.marginTop="2px",r.appendChild(i);const s=u("div",{styles:{flex:"1",display:"flex",flexDirection:"column",gap:C}}),l=u("div",{styles:{lineHeight:x.base},children:[e.message]});if(s.appendChild(l),e.action){const n=u("button",{styles:{alignSelf:"flex-start",padding:`${C} ${k}`,marginTop:C,border:"none",borderRadius:N.md,backgroundColor:"error"===e.type?f.errorBg:p.secondary,color:"error"===e.type?f.error:h.primary,fontSize:w.xs,fontWeight:v.medium,fontFamily:g.sans,cursor:"pointer",transition:`all ${T.fast} ${j.default}`},onClick:()=>{e.action.onClick(),Gr(t)},children:[e.action.label]});s.appendChild(n)}r.appendChild(s);const a=u("button",{styles:{padding:C,border:"none",borderRadius:N.md,backgroundColor:"transparent",color:h.tertiary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:"0",transition:`all ${T.fast} ${j.default}`},onClick:()=>Gr(t),children:[ti()]});a.addEventListener("mouseenter",()=>{a.style.backgroundColor=p.secondary,a.style.color=h.primary}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="transparent",a.style.color=h.tertiary}),r.appendChild(a),_r.appendChild(r);const d={id:t,element:r,options:e};return Jr.set(t,d),setTimeout(()=>{r.style.opacity="1",r.style.transform="translateY(0)"},10),n>0&&(d.timeoutId=setTimeout(()=>Gr(t),n)),t}function Gr(e){const t=Jr.get(e);t&&(t.timeoutId&&clearTimeout(t.timeoutId),t.element.style.opacity="0",t.element.style.transform="translateY(10px)",setTimeout(()=>{t.element.remove(),Jr.delete(e),0===Jr.size&&_r&&(_r.remove(),_r=null)},200))}function ei(e=16){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width",String(e)),t.setAttribute("height",String(e)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t}function ti(){const e=ei(14),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M18 6 6 18"),e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","m6 6 12 12"),e.appendChild(n),e}const ni="0.1.0";let oi=null,ri=!1,ii=null;function si(e){var n;e?(t.setState({active:!0}),document.body.classList.add("orphy-mode"),yt(),gt&&(gt.style.display="block",Ct()),n=ai,se||(le=n,se=u("div",{className:"orphy-overlay",styles:{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",zIndex:R,cursor:"crosshair",background:"transparent"}}),se.addEventListener("mousemove",pe),se.addEventListener("click",he),se.addEventListener("mouseleave",me),document.body.appendChild(se)),ii=e=>{"Escape"===e.key&&(e.preventDefault(),li())},document.addEventListener("keydown",ii)):li()}function li(){t.setState({active:!1,currentElement:null}),document.body.classList.remove("orphy-mode"),Mr(),te(),gt&&(gt.style.display="none"),on(),Ao(),tn(),ko(),se&&(ae&&(clearTimeout(ae),ae=null),de=null,ie=!1,se.removeEventListener("mousemove",pe),se.removeEventListener("click",he),se.removeEventListener("mouseleave",me),se.remove(),se=null,le=null,te()),te(),_&&(_.remove(),_=null),ii&&(document.removeEventListener("keydown",ii),ii=null)}function ai(e,t,n){const o=we(e,t,n);ie=!0,Nr(o,t,n,(t,n,o)=>function(e,t,n,o){if(ce(),te(),!o)return;l.addDraft({orphyId:t.orphyId,selector:t.selector,boundingBox:t.boundingBox,positionInElement:t.positionInElement,positionInViewport:t.positionInViewport,viewport:t.viewport,pageUrl:t.pageUrl,feedbackType:n,comment:e,element:o})}(t,n,o,e),di)}function di(){ce(),te()}function ci(){null!==uo&&Ao(),en(mi)}async function ui(){null!==Gt&&on();Co(await Gn(),{onSelect:pi,onClose:()=>{ko(),te()},onBackToList:te,onReplySubmit:hi})}function pi(e){const t=document.querySelector(e.selector);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),ee(t))}async function hi(e,t){return async function(e,t){if(!Zn)return null;try{const n=Zn.apiUrl.replace("/review","/replay"),o=await fetch(`${n}/${e}/replies`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})});if(!o.ok)throw new Error(`Failed to create reply: ${o.status}`);const{replyId:r}=await o.json(),i={id:r,authorType:"client",content:t,createdAt:Date.now()},s=Kn.find(t=>t.id===e);return s&&s.replies.push(i),i}catch(n){return console.error("Orphy: Failed to create reply",n),null}}(e,t)}async function mi(e){if(!oi)return;rn(!0),e.forEach(e=>{l.updateDraft(e.tempId,{status:"sending"})});const t=function(){const e=navigator.userAgent;return{browser:a(e),os:d(e),device:c(e),screen:{width:window.screen.width,height:window.screen.height},touchEnabled:"ontouchstart"in window||navigator.maxTouchPoints>0,language:navigator.language||"en"}}();try{const n=await fetch(`${oi.apiUrl}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:oi.projectId,feedbacks:e.map(e=>({orphyId:e.orphyId,selector:e.selector,boundingBox:e.boundingBox,positionInElement:e.positionInElement,positionInViewport:e.positionInViewport,viewport:e.viewport,pageUrl:e.pageUrl,feedbackType:e.feedbackType,comment:e.comment,deviceInfo:t}))})});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.error||`HTTP ${n.status}`)}const{feedbacks:o}=await n.json();e.forEach(e=>{l.updateDraft(e.tempId,{status:"sent"})}),rn(!1),o.forEach(e=>{oi?.onSubmit?.(e)});const r=o.length;Qr({type:"success",message:1===r?i("toast.successSingle"):i("toast.successMultiple",{count:r})}),setTimeout(()=>{tn(),l.clearSession()},1e3)}catch(n){const t=n instanceof Error?n:new Error(String(n));if(console.error("Orphy: Failed to submit feedbacks",t),rn(!1),e.forEach(e=>{l.updateDraft(e.tempId,{status:"error"})}),Qr({type:"error",message:i("toast.error"),action:{label:i("toast.retry"),onClick:()=>mi(e)}}),oi?.onError){const n=oi.onError;e.forEach(e=>{const o={id:e.tempId,orphyId:e.orphyId,selector:e.selector,boundingBox:e.boundingBox,positionInElement:e.positionInElement,positionInViewport:e.positionInViewport,viewport:e.viewport,pageUrl:e.pageUrl,feedbackType:e.feedbackType,comment:e.comment,timestamp:e.timestamp};n(t,o)})}}}return e.VERSION=ni,e.destroy=function(){ri&&(at()&&lt(),li(),vn&&(vn.remove(),vn=null,xn=null,Cn=null,kn=null,An=null,Sn=null,En=null,$n=null,In=null),ft(),null!==wt&&(cancelAnimationFrame(wt),wt=null),window.removeEventListener("scroll",At),window.removeEventListener("resize",At),vt.clear(),gt?.remove(),gt=null,on(),Ao(),tn(),ko(),Jr.forEach((e,t)=>Gr(t)),function(){const e=document.getElementById(q);e&&e.remove()}(),Kn=[],Qn=0,t.reset(),l.clearSession(),oi=null,ri=!1)},e.getFeedbacks=function(){return t.getFeedbacks()},e.init=function(e){if(ri)return void console.warn("Orphy is already initialized");if(!e.projectId||"string"!=typeof e.projectId)throw new Error("Orphy: projectId is required");if(!e.apiUrl||"string"!=typeof e.apiUrl)throw new Error("Orphy: apiUrl is required");var t;oi=e,ri=!0,t=e.locale??"fr",o[t]?r=o[t]:(console.warn(`Orphy: Unknown locale "${t}", falling back to "fr"`),r=n);const i=oi.apiUrl.replace(/\/feedback\/batch$/,"/replay");it={apiUrl:i};const s=oi.apiUrl.replace(/\/feedback\/batch$/,"/review");var a;a={apiUrl:s,projectId:oi.projectId},Zn=a;const d=new URLSearchParams(window.location.search).get("orphy_replay");if(d)return console.log(`Orphy v${ni} entering replay mode`),void st(d);!function(){if(document.getElementById(q))return;const e=document.createElement("style");e.id=q,e.textContent=`\n    /* =================================================================\n       REVIEWLY RESPONSIVE STYLES\n       ================================================================= */\n\n    /* CSS Custom Properties - Desktop defaults */\n    :root {\n      --orphy-comment-box-width: 420px;\n      --orphy-comment-box-position: fixed;\n      --orphy-comment-box-bottom: auto;\n      --orphy-comment-box-left: auto;\n      --orphy-comment-box-right: auto;\n      --orphy-comment-box-transform: none;\n      --orphy-comment-box-radius: 8px;\n      --orphy-comment-box-max-height: 80vh;\n\n      --orphy-panel-width: 320px;\n\n      --orphy-type-grid: flex;\n      --orphy-type-direction: row;\n      --orphy-type-wrap: nowrap;\n    }\n\n    /* =================================================================\n       TABLET (480px - 768px)\n       ================================================================= */\n    @media screen and (max-width: ${X}px) {\n      :root {\n        --orphy-comment-box-width: 380px;\n      }\n    }\n\n    /* =================================================================\n       MOBILE (< 480px)\n       ================================================================= */\n    @media screen and (max-width: ${Y}px) {\n      :root {\n        --orphy-comment-box-width: calc(100vw - 32px);\n        --orphy-comment-box-radius: 12px 12px 0 0;\n        --orphy-panel-width: 100vw;\n        --orphy-type-wrap: wrap;\n      }\n\n      /* Comment box - Bottom sheet style on mobile */\n      .orphy-comment-box {\n        position: fixed !important;\n        bottom: 0 !important;\n        left: 16px !important;\n        right: 16px !important;\n        top: auto !important;\n        width: calc(100vw - 32px) !important;\n        max-width: none !important;\n        border-radius: 12px 12px 0 0 !important;\n        max-height: 70vh !important;\n        animation: orphy-slide-up 0.25s ease-out;\n      }\n\n      /* Type selector - wrap on mobile */\n      .orphy-type-selector {\n        flex-wrap: wrap !important;\n        gap: 8px !important;\n      }\n\n      .orphy-type-selector button {\n        flex: 1 1 calc(50% - 4px) !important;\n        min-width: calc(50% - 4px) !important;\n        justify-content: center !important;\n      }\n\n      /* Review panel - Full width bottom sheet */\n      .orphy-review-panel {\n        position: fixed !important;\n        bottom: 0 !important;\n        left: 0 !important;\n        right: 0 !important;\n        top: auto !important;\n        width: 100vw !important;\n        max-width: none !important;\n        border-radius: 12px 12px 0 0 !important;\n        max-height: 80vh !important;\n        animation: orphy-slide-up 0.25s ease-out;\n      }\n\n      /* Toolbar - Adjust position for thumb reach */\n      .orphy-toolbar {\n        bottom: 20px !important;\n        right: 16px !important;\n      }\n    }\n\n    /* =================================================================\n       ANIMATIONS\n       ================================================================= */\n    @keyframes orphy-slide-up {\n      from {\n        transform: translateY(100%);\n        opacity: 0;\n      }\n      to {\n        transform: translateY(0);\n        opacity: 1;\n      }\n    }\n\n    @keyframes orphy-spin {\n      from {\n        transform: rotate(0deg);\n      }\n      to {\n        transform: rotate(360deg);\n      }\n    }\n\n    /* =================================================================\n       TOUCH IMPROVEMENTS\n       ================================================================= */\n    @media (hover: none) and (pointer: coarse) {\n      /* Larger touch targets on touch devices */\n      .orphy-type-selector button {\n        min-height: 44px !important;\n        padding: 10px 12px !important;\n      }\n\n      .orphy-comment-submit,\n      .orphy-comment-cancel {\n        min-height: 44px !important;\n        padding: 12px 16px !important;\n      }\n\n      /* Disable hover effects on touch */\n      .orphy-toolbar button:hover {\n        transform: none !important;\n      }\n    }\n  `,document.head.appendChild(e)}(),mt(),gt||(gt=document.createElement("div"),gt.id="orphy-badges-layer",Object.assign(gt.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",pointerEvents:"none",zIndex:"999996"}),document.body.appendChild(gt),l.subscribe(Ct),window.addEventListener("scroll",At,{passive:!0}),window.addEventListener("resize",At,{passive:!0})),Hn(si,ci,ui),async function(){try{const n=await Gn(),o=n.filter(e=>e.replies.length>0);t=o.length,kn&&Sn&&(t>0?(Sn.textContent=String(t),Sn.style.display="flex"):Sn.style.display="none"),e=n.length>0,kn&&(kn.style.display=e?"flex":"none")}catch{}var e;var t}(),console.log(`Orphy v${ni} initialized`)},e.isActive=function(){return t.getState().active},e.isReplayActive=at,e.toggle=function(){if(!ri)return void console.warn("Orphy is not initialized");const{active:e}=t.getState();si(!e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),e}({});
//# sourceMappingURL=orphy.js.map
